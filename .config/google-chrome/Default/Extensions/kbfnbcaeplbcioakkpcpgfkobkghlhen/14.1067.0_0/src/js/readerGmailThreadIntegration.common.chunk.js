(self.webpackChunk=self.webpackChunk||[]).push([[9561],{64078:(e,t,n)=>{n.d(t,{X:()=>S});var i,a=n(59312),o=n(27378),s=n(57050),r=n(19962),l=n(5114),d=n(44060),c=n(67424),m=n(89894),u=n(32096),p=n(40327),h=n(5739),g=n(98403),f=n(49708),b=n(85985),v=n(41398),I=n(24209),k=n(17343),y=n(38194),x=n(598),_=n(50628),E=n(25781),w=n(83078),U=n(18625);!function(e){var t="scrollaction";e.emit=function(e){return self.dispatchEvent(new CustomEvent(t,{detail:e}))},e.observe=U.P((function(){return f.R(self,t)}))}(i||(i={}));var C=n(42103),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._subs=[],t._outOfTarget=function(e){return function(t){return!r.UL.hasPoint(t.getBoundingClientRect(),e)}},t}return(0,a.ZT)(t,e),t.prototype.componentDidMount=function(){this._listenTooltipAppearance()},t.prototype.componentWillUnmount=function(){this._subs.forEach((function(e){return e.unsubscribe()})),this._subs=[],this.context.hide()},t.prototype.render=function(){return o.createElement(h.F.div,{"data-role":"tooltip"},this.context.state.view(this.props.children))},t.prototype._listenTooltipAppearance=function(){var e=this,t=f.R(document,"keydown").pipe(b.h((function(e){return e.keyCode===E.R.ESC_CODE}))),n=f.R(document,"mousedown").pipe(v.M(this.context.state),b.h((function(t){var n=t[0],i=t[1];return(0,p.pipe)(i,l.map((function(e){return e.target})),l.filter((function(){return r.pK(n.target)})),w.wo(e._outOfTarget({x:n.clientX,y:n.clientY})))}))),a=I.T(t,n,f.R(document,"scroll"),i.observe.pipe(b.h((function(e){return"show"===e.detail})))).pipe(k.h(g.PU),y.B());this._subs=[this.context.hasContent.pipe(b.h(Boolean),x.c(a.pipe(_.P()))).subscribe(this.context.hide),this.context.hasContent.pipe(b.h(Boolean),x.c(I.T(g.gw(!0,500),a.pipe(k.h(!1))).pipe(_.P())),b.h(Boolean)).subscribe(this.context.show)]},t.contextType=C.G.Context,t}(o.Component),S=function(){return o.createElement(N,null,(0,s.ls)(l.map((function(e){return o.createElement(c.t.ByAbsoluteRect,(0,a.pi)({rect:r.UL.fromEl(e.target),className:F.container},c.t.Alignment.toSelector(e.alignment),{withPin:!0}),o.createElement("div",{className:F.content},e.content))})),l.toNullable))},M={position:"fixed",zIndex:u.DY,pointerEvents:"none",$nest:{"@media print":{visibility:"hidden"}}},G={padding:"".concat(m.ux.rem(.25)," ").concat(m.ux.rem(1)),borderRadius:m.ux.rem(u.fx),background:d.Il.BackgroundTooltip,color:d.Il.CoreNeutral1,textAlign:"center",whiteSpace:"nowrap",letterSpacing:m.ux.px(.25),fontSize:m.ux.rem(.75),lineHeight:m.ux.rem(1)},F=m.ux.stylesheet({container:[M],content:[G]})},69800:(e,t,n)=>{n.r(t),n.d(t,{createReaderGmailThreadIntegration:()=>ir});var i,a=n(17771),o=n(57050),s=n(64015),r=n(48044),l=n(45614),d=n(29511),c=n(34379),m=n(91625),u=n(27378),p=n(70631),h=n(8125),g=n(5114);!function(e){e.overview="overview",e.coreUserJourney="coreUserJourney",e.pinning="pinning"}(i||(i={}));const f=[i.overview,i.coreUserJourney,i.pinning];function b(e){return"messageView"===e.kind}function v(e){return"pinnedView"===e.kind}function I(e){return"onboardingView"===e.kind}function k(e){return"messageView"===e.kind&&p.d6(e.message)&&(0,o.zG)(e.summary,g.map((0,h.Kg)(p.d6,p.VZ,p.IR)),g.getOrElse(o.W8))&&(0,o.zG)(e.questions,g.map((0,h.Kg)(p.d6,p.VZ,p.IR)),g.getOrElse(o.W8))&&(0,o.zG)(e.mentions,g.map((0,h.Kg)(p.d6,p.VZ,p.IR)),g.getOrElse(o.W8))&&(0,o.zG)(e.links,g.map((0,h.Kg)(p.d6,p.VZ,p.IR)),g.getOrElse(o.W8))}function y(e){return"expanded"===e.kind}var x=n(77176),_=n(5739),E=n(16027),w=n(60797),U=n(76974),C=n(61922);const N={textBoxPlaceholder:"Share your thoughts here.",textBoxAriaLabel:"Feedback text",submitButton:"Submit",cancelButton:"Close",requiredLabel:"Required"},S={onboarding:{optInButton:"Try it out",optOutButton:"No, thanks",prevIconTooltip:"Previous",nextIconTooltip:"Next",badge:"NEW",betaTermsUrl:"https://www.grammarly.com/beta-feature-terms",stepOfN:e=>`${e} OF 3`,overview:{phase0:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points to help you reply faster."},phase1:{title:"Introducing email recaps",body:"Now Grammarly can automatically summarize key points and follow-up actions."},phase2:{title:"Introducing email recaps",body:"Now Grammarly can automatically recap key points and help you decide whether you need to reply."},videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-overview.gif"},coreUserJourney:{title:"Reply faster",body:"Everything you need at your fingertips. Focus on writing, not hunting for details.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-core-user-journey.gif"},pinning:{title:"Choose what's important",body:"Pin key points and things to follow up on while you're reading.",videoSrc:"https://d201kpdrh73vuz.cloudfront.net/reader/onboarding-pinning.gif"}},expandedPanel:{viewButton:{thread:"Messages",pins:"Pinned"},goLeftIconTooltip:"Previous message",goRightIconTooltip:"Next message",jumpFirstIconTooltip:"Jump to first message",jumpLastIconTooltip:"Jump to last message",itemMenu:{copyTooltip:"Copy",pinTooltip:"Add pin",unpinTooltip:"Remove pin",dismissTooltip:"Dismiss",likeTooltip:"Helpful",dislikeTooltip:"Unhelpful",itemLikedTooltip:"This item is helpful",itemDislikedTooltip:"This item isn't helpful"},threadView:{summary:{title:"Summary",emptyTitle:"No items found",errorTitle:"No items found"},needsResponse:{title:"Follow-ups",emptyTitle:"No follow-ups found",errorTitle:"No follow-ups found"},mentions:{title:"Mentions",emptyTitle:"No mentions found",errorTitle:"No mentions found"},links:{title:"Links and attachments",emptyTitle:"No links or attachments found",errorTitle:"No links or attachments found"}},pinnedView:{summary:{title:"Summary",emptyTitle:"Nothing pinned yet",emptyBody:"Pin important summary items to find them more easily.",emptyCTA:"Return to Messages tab"},needsResponse:{title:"Follow-ups",emptyTitle:"Nothing pinned yet",emptyBody:"Pin follow-ups to find them more easily.",emptyCTA:"Return to Messages tab"},mentions:{title:"Mentions",emptyTitle:"Nothing pinned yet",emptyBody:"Pin mentioned items to find them more easily.",emptyCTA:"Return to Messages tab"},links:{title:"Links and attachments",emptyTitle:"Nothing pinned yet",emptyBody:"Pin links and attachments to find them more easily",emptyCTA:"Return to Messages tab"}}},collapseIconTooltip:"Hide email recap",expandIconTooltip:"Open email recap",recapExpandTooltip:"Open email recap",recapCollapseTooltip:"Hide email recap",sendFeedbackButton:"Send feedback",genericFeedbackDialog:{...N,ratings:["Not at all valuable","Slightly valuable","Somewhat valuable","Very valuable","Extremely valuable"],title:"How do you like Grammarly Recap?"},tellsUsMoreFeedbackDialog:{...N,cancelButton:"Skip",title:"Tell us more",description:"We'd love to hear what's going well and how we can improve."},notifications:{thankYou:"Thank you for your feedback"}};var M=n(64757),G=n(76168);const F=E.UI.Grid.make((({slots:e,notify:t})=>u.createElement(_.F.div,{className:G.notification},e.icon,e.content,u.createElement(M.zx.Ghost,{name:"close-notification",onClick:t({kind:"close"})},u.createElement(C.JO.Close,null))))),T=E.UI.Knot.make(F,{icon:E.UI.Node.make((()=>u.createElement(C.JO.NotificationInfo,null))),content:E.UI.Node.make((()=>u.createElement("span",null,S.notifications.thankYou)))});function z(e){return t=>e.closeNotification()}function A(e){return E.Z.composeKnot({root:E.Z.fromSideEffect(z(e),null),icon:()=>U.of(null),content:()=>U.of(null)})}const P=E.UI.Union.make("kind",{thankYou:T}),L=E.UI.Union.asOption(P);function D(e){return E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeUnion({thankYou:A(e)},(()=>e.state.pipe(x.U((e=>e.notification)),w.oA)))}),None:()=>U.of(null)},(()=>e.state.pipe(x.U((e=>e.notification)))))}var R=n(23556),V=n(57053),O=n(22667),B=n(2844),Z=n(22232),H=n(12187),q=n(38983),j=n(78870);const K=e=>E.UI.Grid.make((({slots:t,view:n,notify:i})=>u.createElement("div",{className:j.dialog},u.createElement("header",{className:j.header},u.createElement("div",{className:j.headerGroup},u.createElement(O.K,{size:16}),"Help us improve"),u.createElement(_.F.Fragment,null,n("source").pipe(x.U((e=>u.createElement(M.zx.Ghost,{onClick:i({kind:"close",source:e}),name:"feedback-dialog-close"},u.createElement(C.JO.Close,null))))))),u.createElement(_.F.Fragment,null,t.title,t.rating,t.description),u.createElement(_.F.div,{role:"textbox",...(0,H.Sh)(j.textbox,n("formErrors").pipe(x.U((e=>e.has("textRequired")?j.requiredTextBox:void 0)))),contentEditable:!0,"aria-placeholder":e.textBoxPlaceholder,"data-placeholder":e.textBoxPlaceholder,"aria-label":e.textBoxAriaLabel,onInput:e=>i({kind:"text",text:e.target.innerText})()}),u.createElement(_.F.Fragment,null,n("formErrors").pipe(x.U((t=>t.has("textRequired")?u.createElement("span",{className:j.requiredLabel},e.requiredLabel):null)))),u.createElement("div",{className:j.buttons},u.createElement(_.F.Fragment,null,n("source").pipe(x.U((t=>u.createElement(u.Fragment,null,u.createElement(M.zx.Primary,{onClick:i({kind:"submit",source:t}),name:"feedback-dialog-submit"},e.submitButton),u.createElement(M.zx.Ghost,{onClick:i({kind:"skip",source:t}),name:"feedback-dialog-skip"},e.cancelButton))))))))));function Q(e,t){const n=q.h.create({text:"",formErrors:new Set});return E.Z.fromSideEffect((i=>{switch(i.kind){case"text":n.modify((e=>({text:i.text,formErrors:(0,o.zG)(new Set(e.formErrors),(e=>(e.delete("textRequired"),e)))})));break;case"close":n.set({text:"",formErrors:new Set}),e.closeFeedbackDialog(i.source);break;case"skip":n.set({text:"",formErrors:new Set}),e.skipFeedbackDialog(i.source);break;case"submit":""===n.get().text.trim()?n.modify((e=>({...e,formErrors:new Set(["textRequired"])}))):(e.submitFeedbackDialog(i.source,n.get().text,t()),n.set({text:"",formErrors:new Set}));break;default:(0,Z.vE)(i)}}),B.aj([e.state.pipe(x.U((e=>e.feedbackDialog)),w.oA),n]).pipe(x.U((([{source:e},{formErrors:t}])=>({source:e,formErrors:t})))))}var $=n(90845),W=n(93508),J=n(19962),Y=n(61033);const X=({onMount:e})=>u.createElement("div",{ref:e,className:Y.panelOverlay}),ee=E.UI.Grid.make((({state:e,slots:t})=>{const{ref:n,onMount:i}=$.P.useElWatcher(),a=B.aj([e,n.pipe(x.U(g.map(J.UL.fromEl)),w.oA)]).pipe(x.U((([e,t])=>({..."bottom"===e.dialogSide?{top:e.sourceRect.bottom-t.top}:"top"===e.dialogSide?{bottom:t.bottom-e.sourceRect.bottom+e.sourceRect.height}:{},..."right"===e.alignment?{right:t.right-e.sourceRect.right}:{}}))),W.O({}));return u.createElement(u.Fragment,null,u.createElement(X,{onMount:i}),u.createElement(_.F.div,{className:Y.dialog,style:a},t.content))}));function te(e){return()=>e.state.pipe(x.U((e=>e.feedbackDialog)),w.oA,x.U((e=>e.position)))}var ne=n(56229);const ie=E.UI.Node.make((({notify:e})=>u.createElement(V.i,{maxRating:S.genericFeedbackDialog.ratings.length,ratingLabels:S.genericFeedbackDialog.ratings,className:ne.ratingContainer,ratingStarsClassName:ne.ratingStars,ratingLegendClassName:ne.ratingLegend,ratingLabelsClassName:ne.ratingLabels,onChange:t=>e({rating:t})(),ariaLabel:S.genericFeedbackDialog.title}))),ae=E.UI.Knot.make(K(S.genericFeedbackDialog),{title:E.UI.Node.make((()=>u.createElement("h1",{className:ne.title},S.genericFeedbackDialog.title))),rating:ie,description:E.UI.Node.empty}),oe=E.UI.Knot.make(ee,{content:ae}),se=E.UI.Union.asOption(oe);var re=n(55415),le=n(35115);const de=E.UI.Knot.make(K(S.tellsUsMoreFeedbackDialog),{title:E.UI.Node.make((()=>u.createElement("h1",{className:le.title},S.tellsUsMoreFeedbackDialog.title))),rating:E.UI.Node.empty,description:E.UI.Node.make((()=>u.createElement("p",{className:le.description},S.tellsUsMoreFeedbackDialog.description)))}),ce=E.UI.Knot.make(ee,{content:de}),me=E.UI.Union.asOption(ce);function ue(e,t){return E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:te(e),content:E.Z.composeKnot({root:Q(e,(()=>g.none)),title:()=>U.of(null),rating:()=>U.of(null),description:()=>U.of(null)})})}),None:()=>U.of(null)},(()=>e.state.pipe(x.U((0,o.ls)(re.ei("feedbackDialog"),g.filter(t))))))}var pe=n(32952),he=n(41398),ge=n(2834);const fe=E.UI.Node.make((({state:e,notify:t})=>{const{ref:n,onMount:i}=$.P.useElWatcher(),a=u.useRef(new pe.xQ);return $.P.useSubscriptionTo(a.current.pipe(he.M(n),x.U((([e,t])=>g.map(J.UL.fromEl)(t))),w.oA,ge.b((e=>t({kind:"openFeedback",buttonRect:e})())))),u.createElement(_.F.Fragment,null,e.pipe(x.U((({active:e,isSupported:t})=>t?u.createElement(M.zx.Ghost,{mount:i,onClick:()=>a.current.next(),name:"panel-open-feedback-button",title:S.sendFeedbackButton,ariaLabel:S.sendFeedbackButton,active:e},u.createElement(C.JO.AssistantFeedback,null)):null))))}));function be(e,t){return E.Z.fromSideEffect((n=>{if("openFeedback"===n.kind)t?e.openFeedbackDialogFromPanelCollapsed({kind:"collapsedPanelButton"},{sourceRect:n.buttonRect,dialogSide:"top",alignment:"right"}):e.openFeedbackDialogFromPanelExpanded({kind:"expandedPanelHeaderButton"},{sourceRect:n.buttonRect,dialogSide:"bottom",alignment:"right"});else(0,Z.vE)(n.kind)}),e.state.pipe(x.U((e=>e.feedbackDialog)),x.U((n=>({active:(0,o.zG)(n,g.fold(o.jv,(({source:e})=>t?"collapsedPanelButton"===e.kind:"expandedPanelHeaderButton"===e.kind))),isSupported:e.isFeedbackSupported})))))}const ve=E.UI.Grid.make((({slots:e})=>u.createElement(_.F.Fragment,null,e.button,e.dialog))),Ie=E.UI.Knot.make(ve,{button:fe,dialog:se});function ke(e,t,n){return E.Z.composeKnot({button:be(e,t),dialog:ue(e,n)})}var ye=n(64908),xe=n(86705),_e=n(53112),Ee=n(58120);const we=({onClick:e,title:t,focusable:n,browser:i,ariaLabel:a})=>u.createElement(M.zx.Flat,{className:Ee.recapButton,onClick:e,name:"recap-button",title:t,ariaLabel:a,tabIndex:n?0:-1},u.createElement(O.K,{size:22.4,className:Ee.logo}),u.createElement(Ue,null),u.createElement(xe.v,{browser:i})),Ue=({color:e=_e.Z.neutral70})=>u.createElement("svg",{width:"44",height:"10",viewBox:"0 0 44 10",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"Recap",className:Ee.recap},u.createElement("path",{d:"M0 9.54578V0.454902H3.92401C4.53474 0.441273 5.14052 0.567287 5.69515 0.823335C6.18417 1.05365 6.59476 1.42255 6.8759 1.88423C7.168 2.38768 7.31401 2.96257 7.29756 3.54439C7.31546 4.10697 7.17223 4.66295 6.88473 5.14684C6.61248 5.58484 6.21939 5.93477 5.75281 6.15448L7.5994 9.54578H4.9183L3.32033 6.5451H2.46806V9.54578H0ZM2.46804 4.62749H3.33804C3.69403 4.64717 4.04783 4.56065 4.35456 4.37891C4.48182 4.28258 4.58244 4.1554 4.6469 4.00939C4.71137 3.86337 4.73756 3.70334 4.723 3.54439C4.73683 3.38295 4.71041 3.22059 4.64612 3.07185C4.58182 2.92312 4.48164 2.79264 4.35456 2.69212C4.05216 2.49864 3.69646 2.40545 3.33804 2.42578H2.46804V4.62749Z",fill:e}),u.createElement("path",{d:"M8.85059 9.5458V0.454918H15.4024V2.44356H11.3187V4.00606H15.0651V5.99469H11.3187V7.55719H15.3847V9.5458H8.85059Z",fill:e}),u.createElement("path",{d:"M25.1719 3.86399H22.6684C22.6488 3.48459 22.4872 3.12646 22.2156 2.8608C22.0648 2.72733 21.8892 2.6249 21.6988 2.5594C21.5084 2.49389 21.3069 2.46658 21.1059 2.47905C20.8315 2.46406 20.5576 2.51745 20.3089 2.63444C20.0602 2.75143 19.8445 2.92836 19.681 3.14933C19.3227 3.69763 19.15 4.34649 19.1883 5.00036C19.1409 5.66688 19.3157 6.33031 19.6854 6.8869C19.8521 7.09645 20.0662 7.26331 20.3101 7.37369C20.5541 7.48407 20.8208 7.53479 21.0882 7.52167C21.4779 7.542 21.862 7.42235 22.1713 7.18431C22.4451 6.94828 22.6221 6.61948 22.6684 6.26097L25.1719 6.27873C25.1359 6.68719 25.0261 7.08574 24.8479 7.45505C24.4293 8.33025 23.6927 9.01287 22.7883 9.36375C22.1411 9.60001 21.4525 9.70142 20.7647 9.66174C20.0769 9.62206 19.4045 9.44212 18.7888 9.133C18.1238 8.76993 17.5792 8.22072 17.2218 7.5527C16.8183 6.76399 16.6213 5.88584 16.6493 5.00033C16.62 4.11171 16.8219 3.23071 17.2352 2.44351C17.5977 1.77593 18.1468 1.22837 18.8154 0.867676C19.4982 0.504684 20.2616 0.319939 21.0348 0.330567C21.7374 0.318011 22.4343 0.458893 23.0768 0.743384C23.6602 1.00422 24.1608 1.42034 24.5238 1.94633C24.906 2.51684 25.1296 3.17864 25.1719 3.86399Z",fill:e}),u.createElement("path",{d:"M28.3137 9.5458H25.6504L28.6511 0.454918H32.0246L35.0254 9.5458H32.3621L31.8382 7.8058H28.8375L28.3137 9.5458ZM29.3968 5.95918H31.2789L30.3734 2.95847H30.3024L29.3968 5.95918Z",fill:e}),u.createElement("path",{d:"M36.2773 9.54575V0.454869H40.2013C40.8155 0.440928 41.4237 0.578119 41.9724 0.854376C42.4653 1.10813 42.8751 1.49788 43.1532 1.97742C43.4429 2.49314 43.5886 3.07729 43.5749 3.66865C43.5901 4.26188 43.4394 4.84758 43.1399 5.35988C42.852 5.83714 42.4307 6.21979 41.9281 6.46071C41.3612 6.72892 40.7395 6.86116 40.1125 6.8469H38.7453V9.54573L36.2773 9.54575ZM38.7453 4.9293H39.6153C39.9848 4.95083 40.3486 4.83012 40.6319 4.59194C40.7558 4.47337 40.8528 4.32958 40.9164 4.1703C40.9799 4.01102 41.0086 3.83995 41.0003 3.66865C41.0097 3.49854 40.9816 3.32845 40.9179 3.17043C40.8542 3.0124 40.7566 2.87032 40.6319 2.75423C40.3461 2.52145 39.9833 2.40425 39.6153 2.42575H38.7453V4.9293Z",fill:e})),Ce=E.UI.Grid.make((({state:e,slots:t,notify:n})=>($.P.useEffectOnDidMount(n("panelMounted")),u.createElement(_.F.div,{className:ye.panelGrid},u.createElement(_.F.div,{className:ye.header},e.pipe(x.U((({expanded:e,browser:t,focusable:i})=>u.createElement(we,{onClick:n(e?"collapse":"expand"),title:e?S.recapCollapseTooltip:S.recapExpandTooltip,ariaLabel:e?S.recapCollapseTooltip:S.recapExpandTooltip,browser:t,focusable:i})))),t.header,u.createElement(_.F.div,{className:ye.toolbar},t.toolbar)),t.content))));function Ne(e){return E.Z.fromSideEffect((t=>{switch(t){case"collapse":e.recapCollapseButtonClick();break;case"expand":e.recapExpandButtonClick();break;case"panelMounted":e.panelShow();break;default:(0,Z.vE)(t)}}),e.state.pipe(x.U((t=>({expanded:y(t),browser:e.browser,focusable:g.isNone(t.feedbackDialog)})))))}const Se=E.UI.Node.make((({state:e,notify:t})=>u.createElement(_.F.Fragment,null,e.pipe(x.U((({expanded:e,focusable:n})=>u.createElement(M.zx.Ghost,{onClick:t(e?"collapse":"expand"),name:"toggle-panel-button",title:e?S.collapseIconTooltip:S.expandIconTooltip,ariaLabel:e?S.collapseIconTooltip:S.expandIconTooltip,tabIndex:n?0:-1},u.createElement(C.JO.Arrow,{direction:e?C.n4.up:C.n4.down}))))))));function Me(e){return E.Z.fromSideEffect((t=>{switch(t){case"expand":e.expandButtonClick();break;case"collapse":e.collapseButtonClick();break;default:(0,Z.vE)(t)}}),e.state.pipe(x.U((e=>({expanded:y(e),focusable:g.isNone(e.feedbackDialog)})))))}const Ge=E.UI.Group.make({left:Ie,right:Se}),Fe=E.UI.Knot.make(Ce,{header:E.UI.Node.make((()=>u.createElement("div",{className:R.header}))),toolbar:Ge,content:E.UI.Node.empty});function Te(e){return E.Z.composeKnot({root:Ne(e),header:()=>U.of(null),toolbar:E.Z.composeKnot({left:ke(e,!0,(e=>"collapsedPanelButton"===e.source.kind)),right:Me(e)}),content:()=>U.of(null)})}var ze=n(85985),Ae=n(49708),Pe=n(83771);const Le=(0,H.xb)((({children:e})=>u.createElement("h6",{className:Pe.sectionTitle},e))),De=e=>E.UI.Grid.make((({slots:t,notify:n})=>{const{onMount:i,ref:a}=$.P.useElWatcher();return $.P.useSubscriptionTo(a.pipe(w.cp((e=>Ae.R(e,"scroll"))),ge.b(n("scroll")))),u.createElement("div",{className:Pe.column,style:{flex:e}},u.createElement("div",{className:Pe.scrollView,ref:i},u.createElement(Le,null,t.title),t.content))})),Re=E.UI.Grid.make((({slots:e})=>u.createElement(_.F.div,{className:Pe.layout},e.summary,e.questions,e.mentions,e.links))),Ve=350,Oe=307,Be=266,Ze=266,He=500;var qe=n(26328),je=n(47397);const Ke=({title:e,children:t})=>u.createElement("div",{className:je.empty},u.createElement("div",{className:je.title},e),u.createElement("div",{className:je.body},t));var Qe,$e=n(62337);!function(e){function t(e){return"expandedPanelHeaderButton"===e.source.kind}function n(e){return"readerSummaryItemMenu"===e.source.kind}function i(e){return"readerQuestionItemMenu"===e.source.kind}function a(e){return"readerPersonItemMenu"===e.source.kind}function o(e){return"readerLinkItemMenu"===e.source.kind}e.isExpandedPanelHeaderButton=t,e.isReaderSummaryItemMenu=n,e.isReaderQuestionItemMenu=i,e.isReaderPersonItemMenu=a,e.isReaderLinkItemMenu=o,e.isCollapsedPanel=function(e){return"collapsedPanelButton"===e.source.kind},e.isExpandedPanel=function(e){return(0,h.Kg)(t,n,i,a,o)(e)}}(Qe||(Qe={}));var We=n(19429),Je=n(28043),Ye=n(66310);const Xe={URI:"Observable",map:(e,t)=>e.pipe(x.U(t)),ap:(e,t)=>B.aj([e,t]).pipe(x.U((([e,t])=>e(t)))),of:e=>U.of(e)};function et(e,t,n){return We.VF((i=>(0,o.zG)(t(i),Je.x(),Ye.w((t=>n.traverseWithIndex(Xe)(t,((t,n)=>e(n,t)(i.pipe(ze.h((e=>e.key===t)),x.U((e=>e.action)))))))),Je.x())))}var tt=n(20855),nt=n(93253);function it(){return E.UI.Grid.make((({state:e,view:t,slots:n,notify:i})=>{const{ref:a,onMount:s}=$.P.useElWatcher(),r=u.useRef(new pe.xQ);return $.P.useSubscriptionTo(r.current.pipe(he.M(a),x.U((([e,t])=>(0,o.zG)(t,g.map((t=>{let n=0,i=0;const a=t.offsetParent;let o=t;for(;o&&o!==a;)n+=o.scrollTop,i+=o.scrollLeft,o=o.parentElement;return{item:e,top:t.offsetTop-n,left:t.offsetLeft+t.offsetWidth-i,width:t.offsetWidth,height:t.offsetHeight}}))))),w.oA,x.U((({item:e,top:t,left:n,width:a,height:o})=>i({kind:"openMenu",item:e,itemRect:$e.Wm.create({top:t,left:n,width:a,height:o})})())))),u.createElement(_.F.li,{...(0,H.Sh)(nt.item,e.pipe(x.U((e=>e.item.pinned)),x.U((0,h.RN)(nt.pinned,void 0)))),mount:s,tabIndex:t("focusable").pipe(x.U((e=>e?0:-1))),onFocus:t("item").pipe(x.U((e=>()=>{requestAnimationFrame((()=>{i({kind:"focus",item:e})()}))}))),onBlur:t("item").pipe(x.U((e=>t=>{const n=t.currentTarget;requestAnimationFrame((()=>{var t,a;n.contains(document.activeElement)||n.contains((null===(a=null===(t=document.activeElement)||void 0===t?void 0:t.shadowRoot)||void 0===a?void 0:a.activeElement)||null)||i({kind:"blur",item:e})()}))}))),onKeyDown:e=>{var t,n;"ArrowDown"===e.key&&(null===(t=e.currentTarget)||void 0===t?void 0:t.nextElementSibling)instanceof HTMLElement?e.currentTarget.nextElementSibling.focus():"ArrowUp"===e.key&&(null===(n=e.currentTarget)||void 0===n?void 0:n.previousElementSibling)instanceof HTMLElement&&e.currentTarget.previousElementSibling.focus()}},u.createElement("label",{className:nt.content},n.title,n.item),u.createElement(_.F.div,{className:nt.moreButton},e.pipe(x.U((e=>u.createElement(at,{title:"Actions"},u.createElement(M.zx.Ghost,{tabIndex:e.focusable?0:-1,onClick:()=>r.current.next(e.item),ariaLabel:"Actions",name:"actions-button"},u.createElement(C.JO.EllipsisSmall,{className:nt.ellipsis}))))))),n.menu,n.feedback)}))}const at=({children:e,title:t})=>u.createElement(tt.u,{message:t,showDelay:He},u.createElement("div",null,e));function ot(e,t,n,i){return a=>{switch(a.kind){case"focus":t.set(i(a.item));break;case"blur":e.setActiveItemId(null);break;case"openMenu":e.setActiveItemId(i(a.item)),n.set(g.some(a.itemRect)),t.set(i(a.item));break;default:(0,Z.vE)(a)}}}function st(e,t,n,i){return(n===e||null===n&&0===t)&&g.isNone(i)}var rt=n(81336),lt=n(83078),dt=n(67465);function ct(){return E.UI.Node.make((({view:e,state:t,notify:n})=>{const{ref:i,onMount:a}=$.P.useElWatcher(),s=u.useRef(new pe.xQ);return $.P.useSubscriptionTo(s.current.pipe(he.M(i),x.U((([e,t])=>(0,o.zG)(t,g.map(J.UL.fromEl),g.map((t=>({...e,buttonRect:t})))))),w.oA,ge.b((e=>n(e)())))),u.createElement(_.F.div,{mount:a,...(0,H.Sh)(dt.menu,e("item").pipe(x.U((e=>e.pinned?dt.pinned:void 0)))),style:e("bottomRightCorner").pipe(x.U(g.fold((()=>({display:"none"})),(e=>({...e,display:"flex"})))))},t.pipe(x.U((({item:e,clipboardSupported:t,feedbackDialogActive:i,feedbackSupported:a})=>{const r=e.rating===rt.DE.liked||(0,o.zG)(i,lt.FX("like")),l=e.rating===rt.DE.disliked||(0,o.zG)(i,lt.FX("dislike"));return u.createElement(u.Fragment,null,t?u.createElement(mt,{title:S.expandedPanel.itemMenu.copyTooltip},u.createElement(M.zx.Flat,{name:"copy-button",ariaLabel:S.expandedPanel.itemMenu.copyTooltip,className:dt.button,onClick:n({kind:"copy",item:e})},u.createElement(C.JO.Copy,null))):null,u.createElement(mt,{title:e.pinned?S.expandedPanel.itemMenu.unpinTooltip:S.expandedPanel.itemMenu.pinTooltip},u.createElement(M.zx.Flat,{name:"pin-button",ariaLabel:e.pinned?S.expandedPanel.itemMenu.unpinTooltip:S.expandedPanel.itemMenu.pinTooltip,className:dt.button,onClick:n({kind:"pin",item:e,pinned:!e.pinned}),active:e.pinned},u.createElement(C.JO.Pin,null))),u.createElement(mt,{title:S.expandedPanel.itemMenu.dismissTooltip},u.createElement(M.zx.Flat,{name:"remove-button",ariaLabel:S.expandedPanel.itemMenu.dismissTooltip,className:dt.button,onClick:n({kind:"dismiss",item:e})},u.createElement(C.JO.Ignore,null))),a?u.createElement(u.Fragment,null,u.createElement("div",{className:dt.separator}),g.isSome(i)||void 0===e.rating?u.createElement(u.Fragment,null,u.createElement(mt,{title:S.expandedPanel.itemMenu.dislikeTooltip},u.createElement(M.zx.Flat,{name:"dislike-button",ariaLabel:S.expandedPanel.itemMenu.dislikeTooltip,className:dt.button,onClick:()=>s.current.next({kind:"dislike",item:e}),active:l},l?u.createElement(ut.ThumbsDownFilled,null):u.createElement(ut.ThumbsDown,null))),u.createElement(mt,{title:S.expandedPanel.itemMenu.likeTooltip},u.createElement(M.zx.Flat,{name:"like-button",ariaLabel:S.expandedPanel.itemMenu.likeTooltip,className:dt.button,onClick:()=>s.current.next({kind:"like",item:e}),active:r},r?u.createElement(ut.ThumbsUpFilled,null):u.createElement(ut.ThumbsUp,null)))):r?u.createElement(ut.ThumbsUpFilled,{className:dt.inactiveIcon}):l?u.createElement(ut.ThumbsDownFilled,{className:dt.inactiveIcon}):null):null)}))))}))}const mt=({children:e,title:t})=>u.createElement(tt.u,{message:t,showDelay:He},u.createElement("div",null,e));var ut;function pt(e){return t=>{switch(t.kind){case"copy":e.copy(t.item);break;case"dismiss":e.dismiss(t.item);break;case"pin":e.pin(t.item,t.pinned);break;case"like":e.like(t.item,{sourceRect:t.buttonRect,dialogSide:"top",alignment:"right"});break;case"dislike":e.dislike(t.item,{sourceRect:t.buttonRect,dialogSide:"top",alignment:"right"});break;default:(0,Z.vE)(t)}}}function ht(e,t,n,i){return g.toNullable(t)===e||(0,o.zG)(n,g.exists(i(e)))}!function(e){e.ThumbsDown=({className:e,width:t=18})=>u.createElement(C.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.94506 1.49087L3.94129 1.49999L1.22638 7.89292C1.06797 8.31105 1.03966 8.85929 1.01631 9.57841L1.01618 9.58249C1.01167 9.72126 1.00697 9.8662 1.00031 10.0091C1.00591 10.1675 1.08822 10.3603 1.28344 10.5353C1.48809 10.7188 1.74942 10.8182 1.97538 10.8182H8.88923L7.78363 16.1831C7.74404 16.3671 7.78727 16.6111 7.90957 16.807C7.92806 16.8367 7.94592 16.8618 7.96283 16.883C7.97026 16.8765 7.97776 16.87 7.98532 16.8633C8.08412 16.7763 8.18009 16.6875 8.25236 16.6196C8.28819 16.5859 8.31747 16.558 8.33751 16.5387L8.36015 16.5169L8.36114 16.516L13.3603 11.4772C13.5028 11.3373 13.5926 11.1398 13.5926 10.9091V1.81818C13.5926 1.57101 13.483 1.34726 13.3061 1.1944C13.1632 1.07085 12.9836 1 12.7901 1H4.67906C4.66798 1 4.6565 1.00023 4.64528 1.00068M9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273ZM4.64528 1.00068C4.56232 1.00405 4.48416 1.01971 4.41203 1.04526C4.22152 1.11276 4.06246 1.25304 3.97014 1.43608C3.96113 1.45395 3.95276 1.47222 3.94506 1.49087M17.3951 1V9.90909H19V1H17.3951ZM16.3951 0.75C16.3951 0.335787 16.7308 0 17.1451 0H19.25C19.6642 0 20 0.335786 20 0.75V10.1591C20 10.5733 19.6642 10.9091 19.25 10.9091H17.1451C16.7308 10.9091 16.3951 10.5733 16.3951 10.1591V0.75Z",stroke:"none"})),e.ThumbsUp=({className:e,width:t=18})=>u.createElement(C.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.0549 16.5091L16.0587 16.5L18.7736 10.1071C18.932 9.68895 18.9603 9.14071 18.9837 8.42159L18.9838 8.41751C18.9883 8.27874 18.993 8.1338 18.9997 7.99095C18.9941 7.83251 18.9118 7.63967 18.7166 7.46467C18.5119 7.28121 18.2506 7.18182 18.0246 7.18182L11.1108 7.18182L12.2164 1.8169C12.256 1.63292 12.2127 1.38894 12.0904 1.19295C12.0719 1.16332 12.0541 1.13822 12.0372 1.11697C12.0297 1.12346 12.0222 1.13004 12.0147 1.13671C11.9159 1.22375 11.8199 1.31246 11.7476 1.38043C11.7118 1.41412 11.6825 1.44205 11.6625 1.46127L11.6399 1.48305L11.6389 1.48402L6.63965 6.52285C6.49717 6.66269 6.40741 6.86024 6.40741 7.09091L6.40741 16.1818C6.40741 16.429 6.51702 16.6527 6.69386 16.8056C6.83679 16.9291 7.01641 17 7.20987 17L15.3209 17C15.332 17 15.3435 16.9998 15.3547 16.9993M10.9359 0.772727C10.9359 0.772727 11.7297 -7.23009e-07 11.8963 -7.08451e-07C12.7452 -6.34238e-07 13.3949 1.09375 13.194 2.02727L12.3379 6.18182L18.0246 6.18182C19.016 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9832 8.45404C19.961 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909C16.9619 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3577 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20987 18C6.76441 18 6.35535 17.8348 6.03991 17.5621C5.65335 17.228 5.40741 16.7325 5.40741 16.1818L5.40741 7.09091C5.40741 6.59091 5.60568 6.13636 5.93913 5.80909L10.9359 0.772727ZM15.3547 16.9993C15.4377 16.996 15.5158 16.9803 15.588 16.9547C15.7785 16.8872 15.9375 16.747 16.0299 16.5639C16.0389 16.5461 16.0472 16.5278 16.0549 16.5091M2.60495 17L2.60495 8.09091L1.00003 8.09091L1.00003 17L2.60495 17ZM3.60495 17.25C3.60495 17.6642 3.26916 18 2.85495 18L0.750031 18C0.335817 18 3.05469e-05 17.6642 3.05831e-05 17.25L3.14057e-05 7.84091C3.14419e-05 7.4267 0.335818 7.09091 0.750031 7.09091L2.85495 7.09091C3.26916 7.09091 3.60495 7.4267 3.60495 7.84091L3.60495 17.25Z",stroke:"none"})),e.ThumbsDownFilled=({className:e,width:t=18})=>u.createElement(C.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.0208 1.10909C3.03813 1.06714 3.05698 1.02601 3.07728 0.985763C3.28437 0.575142 3.64235 0.257042 4.07809 0.102666C4.2438 0.0439576 4.42076 0.00892764 4.60495 0.00149288C4.62942 0.000509854 4.65435 0 4.67906 0H12.7901C13.2356 0 13.6447 0.165198 13.9601 0.437858C14.3466 0.771997 14.5926 1.26752 14.5926 1.81818V10.9091C14.5926 11.4091 14.3943 11.8636 14.0609 12.1909L9.06411 17.2273C9.06411 17.2273 8.27026 18 8.10374 18C7.25484 18 6.60509 16.9062 6.80597 15.9727L7.66214 11.8182H1.97538C0.984023 11.8182 0 10.9917 0 9.9917C0.0070643 9.84692 0.0119094 9.6977 0.0168363 9.54596C0.039042 8.86205 0.0629075 8.12702 0.299089 7.51818L3.0208 1.10909Z",stroke:"none"}),u.createElement("path",{d:"M17.1451 0C16.7308 0 16.3951 0.335787 16.3951 0.75V10.1591C16.3951 10.5733 16.7308 10.9091 17.1451 10.9091H19.25C19.6642 10.9091 20 10.5733 20 10.1591V0.75C20 0.335786 19.6642 0 19.25 0H17.1451Z",stroke:"none"})),e.ThumbsUpFilled=({className:e,width:t=18})=>u.createElement(C.a1,{className:e,width:t,viewBox:"-1 -1 22 20"},u.createElement("path",{d:"M16.9792 16.8909C16.9618 16.9329 16.943 16.974 16.9227 17.0142C16.7156 17.4249 16.3576 17.743 15.9219 17.8973C15.7562 17.956 15.5792 17.9911 15.395 17.9985C15.3706 17.9995 15.3456 18 15.3209 18L7.20984 18C6.76438 18 6.35532 17.8348 6.03988 17.5621C5.65332 17.228 5.40738 16.7325 5.40738 16.1818L5.40738 7.09091C5.40738 6.59091 5.60565 6.13636 5.9391 5.80909L10.9359 0.772727C10.9359 0.772727 11.7297 0 11.8962 0C12.7451 0 13.3949 1.09375 13.194 2.02727L12.3378 6.18182L18.0246 6.18182C19.0159 6.18182 20 7.0083 20 8.0083C19.9929 8.15308 19.9881 8.3023 19.9831 8.45404C19.9609 9.13795 19.9371 9.87298 19.7009 10.4818L16.9792 16.8909Z",stroke:"none"}),u.createElement("path",{d:"M2.85492 18C3.26913 18 3.60492 17.6642 3.60492 17.25L3.60492 7.84091C3.60492 7.4267 3.26913 7.09091 2.85492 7.09091L0.750001 7.09091C0.335788 7.09091 0 7.42669 0 7.84091V17.25C0 17.6642 0.335787 18 0.75 18H2.85492Z",stroke:"none"}))}(ut||(ut={}));var gt=n(50243);const ft=({children:e})=>u.createElement(_.F.ul,{className:gt.list},e);var bt,vt=n(38459);!function(e){e.Document=({className:e,width:t=16})=>u.createElement(C.a1,{className:e,width:t,viewBox:"0 0 14 17"},u.createElement("path",{d:"M4 4H10M4 7H10M4 10H10M4 13H7M2 16H12C12.5523 16 13 15.5523 13 15V2C13 1.44772 12.5523 1 12 1H2C1.44772 1 1 1.44772 1 2V15C1 15.5523 1.44772 16 2 16Z",stroke:"inherit",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})),e.Image=({className:e,width:t=24})=>u.createElement(C.a1,{dontScale:!0,className:e,viewBox:"0 0 24 24",width:t,height:"24"},u.createElement("path",{d:"M19 6.25001L4.99999 6.25009C4.44771 6.25009 4 6.69781 4 7.25009V16.7577C4 17.31 4.44772 17.7577 5 17.7577H19C19.5523 17.7577 20 17.31 20 16.7577V7.25001C20 6.69772 19.5523 6.25 19 6.25001Z",stroke:"inherit",fill:"none"}),u.createElement("path",{d:"M20 13.7501L15.5 9.25008L10.5 14.2501L8.675 12.6578L4 16.9078",stroke:"inherit",fill:"none",strokeLinecap:"round"}),u.createElement("path",{d:"M7.8248 8.40776C8.52897 8.40776 9.0998 8.9786 9.0998 9.68276C9.0998 10.3869 8.52897 10.9578 7.8248 10.9578C7.12064 10.9578 6.5498 10.3869 6.5498 9.68276C6.5498 8.9786 7.12064 8.40776 7.8248 8.40776Z",fill:"inherit",stroke:"none"}))}(bt||(bt={}));const It=E.UI.Node.make((({state:e,notify:t})=>u.createElement(_.F.Fragment,null,e.pipe(x.U((({item:e,focusable:n})=>u.createElement("a",{href:e.url,target:"_blank",className:vt.linkWrapper,tabIndex:n?0:-1,onClick:t({item:e})},u.createElement("div",{className:vt.linkAndIcon},function(e,t){switch(e){case"hyperlink":return u.createElement(C.JO.Formatting.Link,{className:vt.icon});case"email":return u.createElement(C.JO.Share,{className:vt.icon});case"attachment":switch(t){case"text/plain":case"text/html":case"application/msword":case"application/vnd.apple.pages":case"application/pdf":default:return u.createElement(bt.Document,{className:vt.icon});case"application/vnd.ms-excel":case"application/vnd.apple.numbers":case"application/vnd.ms-powerpoint":case"application/vnd.apple.keynote":case"application/zip":case"application/vnd.rar":return u.createElement(C.JO.Download,{className:vt.icon});case"image/bmp":case"image/heic":case"image/jp2":case"image/png":case"image/svg+xml":case"image/tiff":case"image/gif":case"image/jpeg":return u.createElement(bt.Image,{className:vt.icon})}default:return u.createElement(C.JO.Reference,{className:vt.icon})}}(e.type,e.mimeType),u.createElement("span",{className:vt.link},"hyperlink"===e.type?""!==e.name?e.name:e.url:e.name)))))))));var kt=n(69566);const yt=({title:e})=>u.createElement(_.F.div,{className:kt.title},e),xt=it(),_t=ct(),Et=E.UI.Knot.make(xt,{item:It,title:E.UI.Union.asOption(E.UI.Node.make((({state:e})=>u.createElement(yt,{title:e})))),menu:_t,feedback:me}),wt=E.UI.List.make(s.Bk,Et),Ut=E.UI.Composite.make(E.UI.Grid.make((({slots:e})=>u.createElement(ft,null,e.links))),wt),Ct=e=>t=>e.onLinkItemClick(t.item),Nt=e=>t=>Qe.isReaderLinkItemMenu(t)&&t.source.itemId===e;function St(e,t,n){const i=q.h.create(null),a=q.h.create(g.none),r=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(v,b)),x.U((e=>e.activeMenuItemId)));return et(((l,d)=>{const c=t.pipe(x.U((0,o.ls)(s.hX((e=>e.url===l)),s.YM)),w.oA),m=B.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(x.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:ht(l,i,e,Nt),feedbackDialogActive:(0,o.zG)(e,g.filter(Nt(l)),g.map((e=>e.source.action))),focusable:st(l,d,n,e)}))),Je.x());return E.Z.composeKnot({root:E.Z.fromSideEffect(ot(e,i,a,(e=>e.url)),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:E.Z.fromSideEffect(Ct(e),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>c.pipe(x.U(n)),menu:E.Z.fromSideEffect(pt(e.linkItemActions),m.pipe(x.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,g.map($e.Wm.topLeftPoint)):g.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isFeedbackSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ue(e,Nt(l))})}),(()=>t.pipe(x.U(s.UI(re.ei("url"))))),s.Bk)}var Mt=n(45587);const Gt={lineAndAvatar:Mt.lineAndAvatar,lineAndCheckbox:Mt.lineAndCheckbox,lineOnly:Mt.lineOnly},Ft=({lineCount:e,type:t,className:n})=>u.createElement("div",{className:n},[...Array(e).keys()].map((e=>u.createElement("div",{...(0,H.Sh)(Mt.itemLoading,Gt[t]),key:e},u.createElement("div",{className:Mt.rect}),u.createElement("div",{className:Mt.line}))))),Tt=E.UI.Union.make("_tag",{None:E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.links.emptyTitle}))),Some:E.UI.Group.make({value:Ut})}),zt=E.UI.Node.make((()=>u.createElement(Ft,{type:"lineAndAvatar",lineCount:2}))),At=E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.links.errorTitle}))),Pt=E.UI.Union.make("type",{InProgress:zt,Fatal:At,Error:At,Success:Tt});function Lt(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.links)),ze.h(g.isSome),x.U((e=>e.value))),n=t.pipe(ze.h(p.d6),x.U((e=>e.value)));return E.Z.composeUnion({InProgress:()=>U.of(null),Error:()=>U.of(null),Fatal:()=>U.of(null),Success:E.Z.composeUnion({None:()=>U.of(null),Some:E.Z.composeKnot({value:St(e,n,(()=>g.none))})},(()=>(0,o.zG)(n,x.U(qe.nI))))},(()=>t))}var Dt=n(31846);const Rt=({src:e,name:t})=>{const[n,i]=u.useState(!1);return e&&!n?u.createElement("img",{src:e,className:Dt.image,onError:()=>i(!0),"aria-hidden":!0}):u.createElement("div",{className:Dt.avatar,style:{backgroundColor:_e.Z.neutral40},role:"img","aria-hidden":!0},t?function(e){return(e.split(/\s+/)[0][0]||"").toUpperCase()}(t):"?")};var Vt=n(93383);const Ot=E.UI.Node.make((({state:e})=>u.createElement(_.F.div,{className:Vt.personAndAvatar},e.pipe(x.U((({name:e,email:t,avatarUrl:n})=>u.createElement(u.Fragment,null,u.createElement(Rt,{name:e,src:g.toUndefined(n)}),u.createElement("span",{className:Vt.nameOrEmail},null!=e?e:t)))))))),Bt=it(),Zt=ct(),Ht=E.UI.Knot.make(Bt,{item:Ot,title:E.UI.Union.asOption(E.UI.Node.make((({state:e})=>u.createElement(yt,{title:e})))),menu:Zt,feedback:me}),qt=E.UI.List.make(s.Bk,Ht),jt=E.UI.Composite.make(E.UI.Grid.make((({slots:e})=>u.createElement(ft,null,e.people))),qt),Kt=e=>t=>Qe.isReaderPersonItemMenu(t)&&t.source.itemId===e;function Qt(e,t,n){const i=q.h.create(null),a=q.h.create(g.none),r=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(v,b)),x.U((e=>e.activeMenuItemId)));return et(((l,d)=>{const c=t.pipe(x.U((0,o.ls)(s.hX((e=>e.email===l)),s.YM)),w.oA),m=B.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(x.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:ht(l,i,e,Kt),feedbackDialogActive:(0,o.zG)(e,g.filter(Kt(l)),g.map((e=>e.source.action))),focusable:st(l,d,n,e)}))),Je.x());return E.Z.composeKnot({root:E.Z.fromSideEffect(ot(e,i,a,(e=>e.email)),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:()=>c,title:()=>c.pipe(x.U(n)),menu:E.Z.fromSideEffect(pt(e.personItemActions),m.pipe(x.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,g.map($e.Wm.topLeftPoint)):g.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isFeedbackSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ue(e,Kt(l))})}),(()=>t.pipe(x.U(s.UI(re.ei("email"))))),s.Bk)}const $t=E.UI.Union.make("_tag",{None:E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.mentions.emptyTitle}))),Some:E.UI.Group.make({value:jt})}),Wt=E.UI.Node.make((()=>u.createElement(Ft,{type:"lineAndAvatar",lineCount:2}))),Jt=E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.mentions.errorTitle}))),Yt=E.UI.Union.make("type",{InProgress:Wt,Fatal:Jt,Error:Jt,Success:$t});function Xt(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.mentions)),ze.h(g.isSome),x.U((e=>e.value))),n=t.pipe(ze.h(p.d6),x.U((e=>e.value)));return E.Z.composeUnion({InProgress:()=>U.of(null),Error:()=>U.of(null),Fatal:()=>U.of(null),Success:E.Z.composeUnion({None:()=>U.of(null),Some:E.Z.composeKnot({value:Qt(e,n,(()=>g.none))})},(()=>(0,o.zG)(n,x.U(qe.nI))))},(()=>t))}var en=n(31944),tn=n(11071);const nn=E.UI.Node.make((({state:e,notify:t})=>u.createElement(_.F.Fragment,null,e.pipe(x.U((({item:e,focusable:n})=>u.createElement(en.J,{checked:e.checked,labelId:`question-item-${e.itemId}`,className:tn.checkboxWrapper,checkboxClassName:tn.checkbox,labelClassName:tn.label,onChange:n=>t({checked:n,item:e})(),tabIndex:n?0:-1},u.createElement("div",{...(0,H.Sh)(e.checked?tn.textChecked:void 0,tn.itemText)},e.text)))))))),an=it(),on=ct(),sn=E.UI.Knot.make(an,{item:nn,title:E.UI.Union.asOption(E.UI.Node.make((({state:e})=>u.createElement(yt,{title:e})))),menu:on,feedback:me}),rn=(E.UI.List.make(s.Bk,sn),E.UI.Composite.make(E.UI.Grid.make((({slots:e})=>u.createElement(ft,null,e.list))),E.UI.List.make(s.Bk,sn))),ln=e=>t=>e.checkQuestionItem(t.item,t.checked),dn=e=>t=>Qe.isReaderQuestionItemMenu(t)&&t.source.itemId===e;function cn(e,t,n){const i=q.h.create(null),a=q.h.create(g.none),r=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(v,b)),x.U((e=>e.activeMenuItemId)));return et(((l,d)=>{const c=t.pipe(x.U((0,o.ls)(s.hX((e=>e.itemId===l)),s.YM)),w.oA),m=B.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(x.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:ht(l,i,e,dn),feedbackDialogActive:(0,o.zG)(e,g.filter(dn(l)),g.map((e=>e.source.action))),focusable:st(l,d,n,e)}))),Je.x());return E.Z.composeKnot({root:E.Z.fromSideEffect(ot(e,i,a,(e=>e.itemId)),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:E.Z.fromSideEffect(ln(e),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),title:()=>c.pipe(x.U(n)),menu:E.Z.fromSideEffect(pt(e.questionItemActions),m.pipe(x.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,g.map($e.Wm.topLeftPoint)):g.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isFeedbackSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ue(e,dn(l))})}),(()=>t.pipe(x.U(s.UI(re.ei("itemId"))))),s.Bk)}const mn=E.UI.Union.make("_tag",{None:E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.needsResponse.emptyTitle}))),Some:E.UI.Group.make({value:rn})}),un=E.UI.Node.make((()=>u.createElement(Ft,{type:"lineAndCheckbox",lineCount:2}))),pn=E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.needsResponse.errorTitle}))),hn=E.UI.Union.make("type",{InProgress:un,Error:pn,Fatal:pn,Success:mn});function gn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.questions)),ze.h(g.isSome),x.U((e=>e.value))),n=t.pipe(ze.h(p.d6),x.U((e=>e.value))),i=U.of(null);return E.Z.composeUnion({InProgress:()=>i,Error:()=>i,Fatal:()=>i,Success:E.Z.composeUnion({None:()=>i,Some:E.Z.composeKnot({value:cn(e,n,(()=>g.none))})},(()=>(0,o.zG)(n,x.U(qe.nI))))},(()=>t))}var fn=n(83581);const bn=it(),vn=ct(),In=E.UI.Knot.make(bn,{item:E.UI.Node.make((({state:e})=>u.createElement(_.F.div,{className:fn.itemText},e))),title:E.UI.Union.asOption(E.UI.Node.make((({state:e})=>u.createElement(yt,{title:e})))),menu:vn,feedback:me}),kn=E.UI.List.make(s.Bk,In),yn=E.UI.Composite.make(E.UI.Grid.make((({slots:e})=>u.createElement(ft,null,e.list))),kn),xn=e=>t=>Qe.isReaderSummaryItemMenu(t)&&t.source.itemId===e;function _n(e,t,n){const i=q.h.create(null),a=q.h.create(g.none),r=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(v,b)),x.U((e=>e.activeMenuItemId)));return et(((l,d)=>{const c=t.pipe(x.U((0,o.ls)(s.hX((e=>e.itemId===l)),s.YM)),w.oA),m=B.aj([e.state.view("feedbackDialog"),c,i,r,a]).pipe(x.U((([e,t,n,i,a])=>({item:t,itemRect:a,menuActive:ht(l,i,e,xn),feedbackDialogActive:(0,o.zG)(e,g.filter(xn(l)),g.map((e=>e.source.action))),focusable:st(l,d,n,e)}))),Je.x());return E.Z.composeKnot({root:E.Z.fromSideEffect(ot(e,i,a,(e=>e.itemId)),m.pipe(x.U((({item:e,focusable:t})=>({item:e,focusable:t}))))),item:()=>c.pipe(x.U((e=>e.text))),title:()=>c.pipe(x.U(n)),menu:E.Z.fromSideEffect(pt(e.summaryItemActions),m.pipe(x.U((t=>({item:t.item,bottomRightCorner:t.menuActive?(0,o.zG)(t.itemRect,g.map($e.Wm.topLeftPoint)):g.none,clipboardSupported:e.isClipboardSupported,feedbackSupported:e.isFeedbackSupported,feedbackDialogActive:t.feedbackDialogActive}))))),feedback:ue(e,xn(l))})}),(()=>t.pipe(x.U(s.UI(re.ei("itemId"))))),s.Bk)}var En=n(48789);const wn=E.UI.Union.make("_tag",{None:E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.summary.emptyTitle}))),Some:E.UI.Group.make({value:yn})}),Un=E.UI.Node.make((()=>u.createElement(Ke,{title:S.expandedPanel.threadView.summary.errorTitle}))),Cn=E.UI.Node.make((()=>u.createElement(Ft,{className:En.loader,type:"lineOnly",lineCount:2}))),Nn=E.UI.Union.make("type",{InProgress:Cn,Error:Un,Fatal:Un,Success:wn});function Sn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.summary)),ze.h(g.isSome),x.U((e=>e.value))),n=t.pipe(ze.h(p.d6),x.U((e=>e.value)));return E.Z.composeUnion({InProgress:()=>U.of(null),Error:()=>U.of(null),Fatal:()=>U.of(null),Success:E.Z.composeUnion({None:()=>U.of(null),Some:E.Z.composeKnot({value:_n(e,n,(()=>g.none))})},(()=>(0,o.zG)(n,x.U(qe.nI))))},(()=>t))}const Mn=E.UI.Knot.make(De(Ve),{content:Nn,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.threadView.summary.title)))}),Gn=E.UI.Knot.make(De(Oe),{content:hn,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.threadView.needsResponse.title)))}),Fn=E.UI.Knot.make(De(Be),{content:Yt,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.threadView.mentions.title)))}),Tn=E.UI.Knot.make(De(Ze),{content:Pt,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.threadView.links.title)))}),zn=E.UI.Union.asOption(Mn),An=E.UI.Union.asOption(Gn),Pn=E.UI.Union.asOption(Fn),Ln=E.UI.Union.asOption(Tn),Dn=E.UI.Knot.make(Re,{summary:zn,questions:An,mentions:Pn,links:Ln});function Rn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b)),n=t=>e.setActiveItemId(null),i=U.of(null);return E.Z.composeKnot({summary:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Sn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.summary))))),questions:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:gn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.questions))))),mentions:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Xt(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.mentions))))),links:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Lt(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.links)))))})}var Vn=n(37896);function On(e){if("parsedDate"===e.kind){const t=new Date(e.timestamp);return`${Vn.Rb[t.getMonth()]} ${t.getDate()}`}return e.date}var Bn=n(79579);const Zn=E.UI.Union.make("_tag",{None:E.UI.Node.make((({notify:e})=>u.createElement(Ke,{title:S.expandedPanel.pinnedView.links.emptyTitle},S.expandedPanel.pinnedView.links.emptyBody,u.createElement(M.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:Bn.emptyCTAButton},S.expandedPanel.pinnedView.links.emptyCTA)))),Some:E.UI.Group.make({value:Ut})});function Hn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(v),x.U((e=>e.links)),ze.h(g.isSome),x.U((e=>e.value)));return E.Z.composeUnion({None:E.Z.fromSideEffect((t=>{if("showMessages"===t)e.openMessageView("emptyPinnedMentions");else(0,Z.vE)(t)}),null),Some:E.Z.composeKnot({value:St(e,t,(e=>(0,o.zG)(e.messagePinnedFrom,g.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${On(e.date)}`})))))})},(()=>(0,o.zG)(t,x.U(qe.nI))))}const qn=E.UI.Union.make("_tag",{None:E.UI.Node.make((({notify:e})=>u.createElement(Ke,{title:S.expandedPanel.pinnedView.mentions.emptyTitle},S.expandedPanel.pinnedView.mentions.emptyBody,u.createElement(M.zx.Ghost,{onClick:e("showMessages"),name:"pinned-mentions-empty-cta",className:Bn.emptyCTAButton},S.expandedPanel.pinnedView.mentions.emptyCTA)))),Some:E.UI.Group.make({value:jt})});function jn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(v),x.U((e=>e.mentions)),ze.h(g.isSome),x.U((e=>e.value)));return E.Z.composeUnion({None:E.Z.fromSideEffect((t=>{if("showMessages"===t)e.openMessageView("emptyPinnedMentions");else(0,Z.vE)(t)}),null),Some:E.Z.composeKnot({value:Qt(e,t,(e=>(0,o.zG)(e.messagePinnedFrom,g.map((e=>{var t;return`From ${null!==(t=e.author.name)&&void 0!==t?t:e.author.email}, ${On(e.date)}`})))))})},(()=>(0,o.zG)(t,x.U(qe.nI))))}const Kn=E.UI.Union.make("_tag",{None:E.UI.Node.make((({notify:e})=>u.createElement(Ke,{title:S.expandedPanel.pinnedView.needsResponse.emptyTitle},S.expandedPanel.pinnedView.needsResponse.emptyBody,u.createElement(M.zx.Ghost,{onClick:e("showMessages"),name:"pinned-follow-ups-empty-cta",className:Bn.emptyCTAButton},S.expandedPanel.pinnedView.needsResponse.emptyCTA)))),Some:E.UI.Group.make({value:rn})});function Qn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(v),x.U((e=>e.questions)),ze.h(g.isSome),x.U((e=>e.value)));return E.Z.composeUnion({None:E.Z.fromSideEffect((t=>{if("showMessages"===t)e.openMessageView("emptyPinnedFollowUps");else(0,Z.vE)(t)}),null),Some:E.Z.composeKnot({value:cn(e,t,(e=>{var t;return g.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${On(e.message.date)}`)}))})},(()=>(0,o.zG)(t,x.U(qe.nI))))}const $n=E.UI.Union.make("_tag",{None:E.UI.Node.make((({notify:e})=>u.createElement(Ke,{title:S.expandedPanel.pinnedView.summary.emptyTitle},S.expandedPanel.pinnedView.summary.emptyBody,u.createElement(M.zx.Ghost,{onClick:e("showMessages"),name:"pinned-summary-empty-cta",className:Bn.emptyCTAButton},S.expandedPanel.pinnedView.summary.emptyCTA)))),Some:E.UI.Group.make({value:yn})});function Wn(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(v),x.U((e=>e.summaryItems)),ze.h(g.isSome),x.U((e=>e.value)));return E.Z.composeUnion({None:E.Z.fromSideEffect((t=>{if("showMessages"===t)e.openMessageView("emptyPinnedSummaries");else(0,Z.vE)(t)}),null),Some:E.Z.composeKnot({value:_n(e,t,(e=>{var t;return g.some(`From ${null!==(t=e.message.author.name)&&void 0!==t?t:e.message.author.email}, ${On(e.message.date)}`)}))})},(()=>(0,o.zG)(t,x.U(qe.nI))))}const Jn=E.UI.Knot.make(De(Ve),{content:$n,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.pinnedView.summary.title)))}),Yn=E.UI.Knot.make(De(Oe),{content:Kn,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.pinnedView.needsResponse.title)))}),Xn=E.UI.Knot.make(De(Be),{content:qn,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.pinnedView.mentions.title)))}),ei=E.UI.Knot.make(De(Ze),{content:Zn,title:E.UI.Node.make((()=>u.createElement("span",null,S.expandedPanel.pinnedView.links.title)))}),ti=E.UI.Union.asOption(Jn),ni=E.UI.Union.asOption(Yn),ii=E.UI.Union.asOption(Xn),ai=E.UI.Union.asOption(ei),oi=E.UI.Knot.make(Re,{summary:ti,questions:ni,mentions:ii,links:ai});function si(e){const t=e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(v)),n=t=>e.setActiveItemId(null),i=U.of(null);return E.Z.composeKnot({summary:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Wn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.summaryItems))))),questions:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Qn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.questions))))),mentions:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:jn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.mentions))))),links:E.Z.composeUnion({Some:E.Z.composeKnot({value:E.Z.composeKnot({root:E.Z.fromSideEffect(n,i),content:Hn(e),title:()=>i})}),None:()=>i},(()=>t.pipe(x.U((e=>e.links)))))})}const ri=E.UI.Union.make("kind",{messageView:Dn,pinnedView:oi});function li(e){return E.Z.composeUnion({messageView:Rn(e),pinnedView:si(e)},(()=>e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(v,b)))))}var di=n(37903),ci=n(89739);const mi=E.UI.Node.make((({view:e})=>u.createElement("div",{className:ci.activeMailInfo},u.createElement(_.F.span,{className:ci.date},e("date").pipe(x.U(On))),u.createElement(_.F.span,{className:ci.author},e("author").pipe(x.U((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:e.email}))))))),ui=E.UI.Node.make((()=>u.createElement("div",{className:ci.activeMailInfo},"Loading..."))),pi=E.UI.Union.make("type",{InProgress:ui,Success:mi,Fatal:E.UI.Node.make((()=>u.createElement("div",{className:ci.activeMailInfo}))),Error:E.UI.Node.make((()=>u.createElement("div",{className:ci.activeMailInfo})))});function hi(e){return E.Z.composeUnion({InProgress:()=>U.of(null),Success:()=>e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.header)),ze.h(p.d6),x.U((e=>e.value))),Fatal:()=>U.of(null),Error:()=>U.of(null)},(()=>e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.header)))))}var gi=n(14692);const fi=E.UI.Knot.make(E.UI.Grid.make((({slots:e,state:t,notify:n})=>u.createElement(_.F.div,{className:gi.navigationFrame},u.createElement(_.F.div,{className:gi.buttonGroup},t.pipe(x.U((e=>u.createElement(u.Fragment,null,u.createElement(M.zx.Ghost,{onClick:n("first"),name:"navigate-first",disabled:!e.canGoBack,title:e.canGoBack?S.expandedPanel.jumpFirstIconTooltip:void 0,ariaLabel:e.canGoBack?S.expandedPanel.jumpFirstIconTooltip:void 0,tabIndex:e.focusable?0:-1},u.createElement(C.JO.Exit,{...(0,H.Sh)(gi.iconJump,gi.iconGoFirst)})),u.createElement(M.zx.Ghost,{onClick:n("left"),name:"navigate-left",disabled:!e.canGoBack,title:e.canGoBack?S.expandedPanel.goLeftIconTooltip:void 0,ariaLabel:e.canGoBack?S.expandedPanel.goLeftIconTooltip:void 0,tabIndex:e.focusable?0:-1},u.createElement(C.JO.Arrow,{direction:C.n4.left,className:gi.icon}))))))),e.mailInfo,u.createElement(_.F.div,{className:gi.buttonGroup},t.pipe(x.U((e=>u.createElement(u.Fragment,null,u.createElement(M.zx.Ghost,{onClick:n("right"),name:"navigate-right",disabled:!e.canGoForward,title:e.canGoForward?S.expandedPanel.goRightIconTooltip:void 0,ariaLabel:e.canGoForward?S.expandedPanel.goRightIconTooltip:void 0,tabIndex:e.focusable?0:-1},u.createElement(C.JO.Arrow,{direction:C.n4.right,className:gi.icon})),u.createElement(M.zx.Ghost,{onClick:n("last"),name:"navigate-last",disabled:!e.canGoForward,title:e.canGoForward?S.expandedPanel.jumpLastIconTooltip:void 0,ariaLabel:e.canGoForward?S.expandedPanel.jumpLastIconTooltip:void 0,tabIndex:e.focusable?0:-1},u.createElement(C.JO.Exit,{className:gi.iconJump})))))))))),{mailInfo:pi});function bi(e){return E.Z.composeKnot({root:E.Z.fromSideEffect((t=>e.threadViewNavigate(t)),B.aj([e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(b),x.U((e=>e.navigation))),e.state.view("feedbackDialog")]).pipe(x.U((([e,t])=>({...e,focusable:g.isNone(t)}))))),mailInfo:hi(e)})}var vi=n(16204);const Ii=E.UI.Node.make((({state:e,notify:t})=>u.createElement(_.F.Fragment,null,e.pipe(x.U((({activeView:e,focusable:n})=>u.createElement(M.zx.Group,{sticky:!0,className:vi.buttonGroup},u.createElement(M.zx.White,{name:"thread-view",onClick:t("messageView"),active:"messageView"===e,className:vi.button,tabIndex:n?0:-1},S.expandedPanel.viewButton.thread),u.createElement(M.zx.White,{name:"pinned-view",onClick:t("pinnedView"),active:"pinnedView"===e,className:vi.button,tabIndex:n?0:-1},S.expandedPanel.viewButton.pins))))))));function ki(e){return E.Z.fromSideEffect((t=>{switch(t){case"pinnedView":e.openPinnedView();break;case"messageView":e.openMessageView("messagesButton");break;default:(0,Z.vE)(t)}}),B.aj([e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h((0,h.Kg)(b,v)),x.U((e=>e.kind))),e.state.view("feedbackDialog")]).pipe(x.U((([e,t])=>({activeView:e,focusable:g.isNone(t)})))))}const yi=E.UI.Grid.make((({slots:e})=>u.createElement(_.F.div,{className:di.header},e.viewButtons,e.frame))),xi=E.UI.Union.asOption(fi),_i=E.UI.Union.asOption(Ii),Ei=E.UI.Knot.make(yi,{viewButtons:_i,frame:xi});function wi(e){return E.Z.composeKnot({viewButtons:E.Z.composeUnion({None:()=>U.of(null),Some:E.Z.composeKnot({value:ki(e)})},(()=>e.state.pipe(x.U((e=>y(e)&&(0,h.Kg)(b,v)(e.activeView)?g.some(e):g.none))))),frame:E.Z.composeUnion({None:()=>U.of(null),Some:E.Z.composeKnot({value:bi(e)})},(()=>e.state.pipe(x.U((e=>y(e)&&b(e.activeView)?g.some(e):g.none)))))})}const Ui=E.UI.Group.make({left:Ie,right:Se}),Ci=E.UI.Knot.make(Ce,{header:Ei,toolbar:Ui,content:ri});function Ni(e){return E.Z.composeKnot({root:Ne(e),header:wi(e),toolbar:E.Z.composeKnot({left:ke(e,!1,(e=>"expandedPanelHeaderButton"===e.source.kind)),right:Me(e)}),content:li(e)})}var Si=n(86885),Mi=n(40349);const Gi=E.UI.Node.make((({state:e,notify:t})=>u.createElement("div",{className:Mi.controls},u.createElement("div",{className:Mi.onboardingButtonGroup},u.createElement(M.zx.Primary,{name:"try-it-out-button",onClick:t("optIn"),className:Mi.optInButton},S.onboarding.optInButton),u.createElement(M.zx.Flat,{name:"no-thanks-button",onClick:t("optOut"),className:Mi.optOutButton},S.onboarding.optOutButton)),u.createElement(_.F.div,{className:Mi.navigation},e.pipe(x.U((e=>u.createElement(u.Fragment,null,u.createElement(M.zx.Flat,{name:"left-button",onClick:t("left"),disabled:f[0]===e,className:Mi.leftButton,title:S.onboarding.prevIconTooltip,ariaLabel:S.onboarding.prevIconTooltip},u.createElement(C.JO.Arrow,{direction:C.n4.left,width:12})),u.createElement(M.zx.Flat,{name:"right-button",onClick:t("right"),disabled:f[f.length-1]===e,className:Mi.rightButton,title:S.onboarding.nextIconTooltip,ariaLabel:S.onboarding.nextIconTooltip},u.createElement(C.JO.Arrow,{direction:C.n4.right,width:12,className:Mi.arrowRight})),u.createElement("div",{className:Mi.stepOfN},S.onboarding.stepOfN(f.indexOf(e)+1))))))))));var Fi=n(57391);const Ti=E.UI.Node.make((({state:e})=>u.createElement(u.Fragment,null,u.createElement("link",{rel:"preload",as:"image",href:S.onboarding.overview.videoSrc}),u.createElement("link",{rel:"preload",as:"image",href:S.onboarding.coreUserJourney.videoSrc}),u.createElement("link",{rel:"preload",as:"image",href:S.onboarding.pinning.videoSrc}),u.createElement(_.F.Fragment,null,e.pipe(x.U((e=>u.createElement("img",{src:S.onboarding[e].videoSrc,key:e,className:Fi.illustration}))))))));var zi=n(51869),Ai=n(19230);const Pi=({title:e,children:t})=>u.createElement(u.Fragment,null,u.createElement("div",{className:Ai.title},e),u.createElement("div",{className:Ai.body},t)),Li=({features:e,browser:t})=>{const n=e=>u.createElement(u.Fragment,null,e,u.createElement(xe.v,{browser:t,title:u.createElement("a",{href:S.onboarding.betaTermsUrl,target:"_blank"},"BETA")}));return e.has("needsResponse")&&e.has("mentions")?u.createElement(Pi,{title:n(S.onboarding.overview.phase2.title)},S.onboarding.overview.phase2.body):e.has("needsResponse")?u.createElement(Pi,{title:n(S.onboarding.overview.phase1.title)},S.onboarding.overview.phase1.body):u.createElement(Pi,{title:n(S.onboarding.overview.phase0.title)},S.onboarding.overview.phase0.body)},Di=()=>u.createElement(Pi,{title:S.onboarding.coreUserJourney.title},S.onboarding.coreUserJourney.body),Ri=()=>u.createElement(Pi,{title:S.onboarding.pinning.title},S.onboarding.pinning.body),Vi=E.UI.Node.make((({state:e})=>u.createElement(_.F.Fragment,null,e.pipe(x.U((e=>{switch(e.step){case i.overview:return u.createElement(Li,{key:"step-overview",features:e.features,browser:e.browser});case i.coreUserJourney:return u.createElement(Di,{key:"step-core-user-journey"});case i.pinning:return u.createElement(Ri,{key:"step-pinning"});default:(0,Z.vE)(e.step)}})))))),Oi=({onShow:e,children:t})=>($.P.useEffectOnDidMount(e),u.createElement("div",{className:zi.onboarding},t)),Bi=E.UI.Grid.make((({slots:e,notify:t})=>u.createElement(Oi,{onShow:t("panelMounted")},u.createElement(_.F.div,null,e.illustrations),u.createElement(O.K,{size:22.4,className:zi.logo}),u.createElement("div",{className:zi.content},u.createElement("div",{className:zi.badge},S.onboarding.badge),u.createElement(_.F.div,{className:zi.steps},e.steps),u.createElement(_.F.div,null,e.controls))))),Zi=E.UI.Knot.make(Bi,{steps:Vi,illustrations:Ti,controls:Gi});function Hi(e){return E.Z.fromSideEffect((t=>{const n=t.action;switch(n){case"optIn":e.optIn();break;case"optOut":e.optOut();break;case"left":case"right":e.onboardingViewNavigate(n);break;case"panelMounted":e.onboardingShow();break;default:(0,Z.vE)(n)}}),e.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(I),x.U((t=>({steps:{step:f[t.step],features:t.features,browser:e.browser},illustrations:f[t.step],controls:f[t.step]})))))}var qi=n(35300);const ji=E.UI.Grid.make((({slots:e})=>u.createElement("div",{className:qi.onboarding},u.createElement(_.F.Fragment,null,e.content),u.createElement(_.F.div,{className:qi.toolbar},e.toolbar)))),Ki=E.UI.Knot.make(ji,{content:Zi,toolbar:Se});function Qi(e){return E.Z.composeKnot({toolbar:Me(e),content:Hi(e)})}const $i=E.UI.Union.make("kind",{collapsed:Fe,expanded:Ci,onboarding:Ki}),Wi=E.UI.Knot.make(E.UI.Grid.make((({slots:e})=>u.createElement(_.F.div,{className:Si.panelWrapper},e.content,e.notification))),{content:$i,notification:L});var Ji,Yi,Xi=n(17889),ea=n(34011),ta=n(88848),na=n(29567),ia=n(98403),aa=n(14601),oa=n(12126),sa=n(77843),ra=n(95195),la=n(65219),da=n(81999),ca=n(44760);!function(e){e.thankYou="thankYou"}(Ji||(Ji={})),function(e){e.create=function(e,t=6e3){return{kind:e,dismissTimestamp:Date.now()+t}}}(Yi||(Yi={}));var ma,ua,pa,ha=n(55822);function ga(e,t=self){return t.navigator&&t.navigator.clipboard&&t.navigator.clipboard.writeText?t.navigator.clipboard.writeText(e):Promise.reject("The Clipboard API is not available.")}!function(e){e.empty=(e,t)=>({activeMenuItemId:g.none,activeMessageIndex:g.none,onboardingStep:(null==e?void 0:e.seenOnboarding)?g.none:g.some(0),panelState:"expanded",feedbackDialog:g.none,notification:g.none,activeView:(null==e?void 0:e.seenOnboarding)?"messageView":"onboardingView",annotations:(0,o.zG)(t,g.chain((t=>{var n,i;return g.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations)})),g.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(m.T.decode(n),ra.g_((()=>t),(n=>t.set(e,n)))))))),summaryItems:(0,o.zG)(t,g.chain((t=>{var n,i;return g.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.summaries)})),g.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(la.P.decode(n),ra.g_((()=>t),(n=>t.set(e,n)))))))),people:(0,o.zG)(t,g.chain((t=>{var n,i;return g.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.persons)})),g.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(da.m2.decode(n),ra.g_((()=>t),(n=>t.set(e,n)))))))),links:(0,o.zG)(t,g.chain((t=>{var n,i;return g.fromNullable(null===(i=null===(n=null==e?void 0:e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.links)})),g.fold((()=>new Map),l.To(new Map,((e,t,n)=>(0,o.zG)(ca.Gw.decode(n),ra.g_((()=>t),(n=>t.set(e,n))))))))})}(ma||(ma={}));class fa{constructor(e,t,n,i,s,l,d,c,u){this._threadContext=e,this.browser=i,this._gnar=s,this._sessionUuid=l,this._features=d,this._readerCSState=c,this._actions=u,this._subscriptions=new aa.w,this._threadInfo=q.h.create(g.none),this.isClipboardSupported=function(e=self){return!!(e.navigator&&e.navigator.clipboard&&e.navigator.clipboard.writeText)}(),this.isFeedbackSupported=!1,this._state=q.h.create(ma.empty(this._readerCSState,(0,o.zG)(this._threadContext.get().threadId,g.fromEither))),this._panelInjected=!1,this._onboardingPanelShown=!1,this._userNavigatedInPanel=!1,this.state=q.h.combine(this._threadInfo,this._state,((e,{panelState:t,activeMessageIndex:n,activeView:i,annotations:s,summaryItems:l,people:d,links:c,onboardingStep:u,activeMenuItemId:f,feedbackDialog:b,notification:v})=>{if("collapsed"===t)return{kind:"collapsed",feedbackDialog:b,notification:v};const I=(0,o.zG)(n,g.alt((()=>(0,o.zG)(e,g.map((e=>e.messageCount-1)))))),k=(0,o.zG)(a.Y(g.option)({threadInfo:e,activeIndex:I}),g.chain((({threadInfo:e,activeIndex:t})=>g.fromNullable(e.messages.get(t)))));return{kind:"expanded",feedbackDialog:b,notification:v,activeView:"onboardingView"===i?{kind:"onboardingView",step:(0,o.zG)(u,g.getOrElse((()=>0))),features:this._features}:"pinnedView"===i?{kind:"pinnedView",summaryItems:(0,o.zG)(l,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(la.h.ord),ba(this._features,"summaries")),questions:(0,o.zG)(s,r.hX((e=>!e.dismissed&&e.pinned)),r.VO(m.p.ord),ba(this._features,"needsResponse")),mentions:(0,o.zG)((0,o.zG)(d,r.hX((0,h.W9)((e=>!e.dismissed),da.ln)),r.VO(da.e3.ord)),va(this._features,["mentions","peopleAndLinks"])),links:(0,o.zG)((0,o.zG)(c,r.hX((0,h.W9)((e=>!e.dismissed),ca.kP)),r.VO(ca.WO.ord)),ba(this._features,"links")),activeMenuItemId:f}:"messageView"===i?{kind:"messageView",header:(0,o.zG)(k,g.fold((()=>p.x5),(e=>(0,o.zG)(e.message,p.UI((e=>({author:e.author,date:e.date}))))))),navigation:{canGoBack:(0,o.zG)(I,g.exists((e=>e>0))),canGoForward:(0,o.zG)(a.Y(g.option)({activeIndex:I,threadInfo:e}),g.exists((({activeIndex:e,threadInfo:t})=>e<t.messageCount-1)))},message:(0,o.zG)(k,g.fold((()=>p.x5),(e=>(0,o.zG)(e.message,p.UI((e=>({id:e.id,date:e.date,wordCount:e.wordCount}))))))),summary:(0,o.zG)(Ia(k,l),ba(this._features,"summaries")),questions:(0,o.zG)(ka(k,s),ba(this._features,"needsResponse")),mentions:(0,o.zG)(ya(k,d,(0,o.zG)(e,g.map((e=>e.avatars)))),va(this._features,["mentions","peopleAndLinks"])),links:(0,o.zG)(xa(k,c),ba(this._features,"links")),activeMenuItemId:f}:(0,Z.vE)(i)}})),this._maybeThreadId=(0,o.zG)(this._threadContext.get().threadId,g.fromEither,g.toUndefined),this.summaryItemActions=this._createSummaryItemActionsHandler(),this.questionItemActions=this._createQuestionItemActionsHandler(),this.personItemActions=this._createPersonItemActionsHandler(),this.linkItemActions=this._createLinkItemActionsHandler(),this._subscriptions.add(B.aj([this._threadContext,n.pipe(W.O(null)),t.pipe(W.O(null))]).pipe(x.U((([e,t,n])=>g.some({messageCount:e.messageCount,avatars:e.avatars,messages:(0,o.zG)(e.expandedMessages,r.Su(((e,i)=>({message:(0,o.zG)(i,p.UI((e=>({id:e.id,index:e.index,author:e.context.author,audience:e.context.audience,links:e.context.links,wordCount:e.textMap.getPlainText().trim().split(/\s+/).length,date:e.context.date})))),summary:(null==n?void 0:n.get(e))||(p.VZ(i)||p.IR(i)?p.kH(i.error):p.x5),annotations:(null==t?void 0:t.get(e))||(p.VZ(i)||p.IR(i)?p.kH(i.error):p.x5)}))),(t=>(0,o.zG)(e.messageIndexToIdMap,r.UI((e=>t.get(e))))))})))).subscribe(ia.wW(this._threadInfo))),this._subscriptions.add(this._threadContext.view("messageCount").subscribe((e=>this._state.modify((t=>({...t,activeMessageIndex:(0,o.zG)(t.activeMessageIndex,g.map((t=>Math.max(0,Math.min(t,e-1)))))})))))),this._subscriptions.add(this._trackMessageShow()),this._subscriptions.add(this._autoDismissNotifications())}panelShow(){this._panelInjected||"onboardingView"===this._state.get().activeView||(this._gnar.readerMailPanelShow(this._sessionUuid,this._maybeThreadId),this._panelInjected=!0)}onboardingShow(){this._onboardingPanelShown||(this._gnar.readerMailOnboardingPanelShow(this._sessionUuid,this._maybeThreadId),this._onboardingPanelShown=!0)}recapExpandButtonClick(){this._state.modify((e=>({...e,panelState:"expanded",feedbackDialog:g.none,notification:g.none}))),this._gnar.readerMailRecapExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId)}recapCollapseButtonClick(){this._state.modify((e=>({...e,panelState:"collapsed",feedbackDialog:g.none,notification:g.none}))),this._gnar.readerMailRecapCollapseButtonClick(this._sessionUuid,this._maybeThreadId)}collapseButtonClick(){this._gnar.readerMailPanelCollapseButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId),this._state.modify((e=>({...e,panelState:"collapsed",feedbackDialog:g.none,notification:g.none})))}expandButtonClick(){this._state.modify((e=>({...e,panelState:"expanded",feedbackDialog:g.none,notification:g.none}))),this._gnar.readerMailPanelExpandButtonClick(this._state.get().activeView,this._sessionUuid,this._maybeThreadId)}optIn(){this._state.modify((e=>({...e,activeView:"messageView",onboardingStep:g.none}))),this._actions.onboardingFinished("opt-in"),this._gnar.readerMailOnboardingPanelOptInButtonClick(this._sessionUuid,this._maybeThreadId)}optOut(){this._state.modify((e=>({...e,panelState:"collapsed",onboardingStep:g.none,feedbackDialog:g.none,notification:g.none}))),this._actions.onboardingFinished("opt-out"),this._gnar.readerMailOnboardingPanelOptOutButtonClick(this._sessionUuid,this._maybeThreadId)}onboardingViewNavigate(e){const t=(0,o.zG)(this._state.get().onboardingStep,g.getOrElse((()=>0)),(t=>{switch(e){case"left":return Math.max(t-1,0);case"right":return Math.min(t+1,2);default:(0,Z.vE)(e)}}));this._state.modify((e=>({...e,onboardingStep:g.some(t)}))),this._gnar.readerMailOnboardingPanelNavigationButtonClick(this._sessionUuid,f[t],this._maybeThreadId)}threadViewNavigate(e){this._userNavigatedInPanel=!0,(0,o.zG)(a.Y(g.option)({info:this._threadInfo.get(),activeIdx:(0,o.zG)(this._state.get().activeMessageIndex,g.alt((()=>(0,o.zG)(this._threadInfo.get(),g.map((e=>e.messageCount-1))))))}),lt.bw((({info:t,activeIdx:n})=>{(0,o.zG)(function(e,t,n){if("left"===e&&t>0)return g.some(t-1);if("right"===e&&t<n-1)return g.some(t+1);if("first"===e&&t>0)return g.some(0);if("last"===e&&t<n-1)return g.some(n-1);return g.none}(e,n,t.messageCount),lt.bw((t=>{this._state.modify((e=>({...e,activeMessageIndex:g.some(t)}))),this._actions.navigate(t,e),this._gnar.readerMailPanelNavigationButtonClick(e,this._sessionUuid,this._maybeThreadId)})))})))}openPinnedView(){this._state.modify((e=>({...e,activeView:"pinnedView"}))),this._gnar.readerMailPanelPinnedButtonClick(this._sessionUuid,this._maybeThreadId)}openMessageView(e){switch(this._state.modify((e=>({...e,activeView:"messageView"}))),e){case"messagesButton":this._gnar.readerMailPanelMessagesButtonClick(this._sessionUuid,this._maybeThreadId);break;case"emptyPinnedSummaries":case"emptyPinnedFollowUps":case"emptyPinnedMentions":this._gnar.readerMailPanelReturnToMessagesButtonClick(this._sessionUuid,e,this._maybeThreadId);break;default:(0,Z.vE)(e)}}checkQuestionItem(e,t){this._state.modify((n=>({...n,annotations:(0,o.zG)(n.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,checked:t}))),g.getOrElse((()=>(0,o.zG)(n.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,checked:t})))))}))),this._actions.updateAnnotationItem({...e,checked:t}),this._gnar.readerMailPanelQuestionItemCheck(e.message.id,this._state.get().activeView,this._sessionUuid,t,this._maybeThreadId)}_createSummaryItemActionsHandler(){return{pin:(e,t)=>{this._pinSummaryItem(e,t),this.setActiveItemId(null)},copy:e=>{this._copySummaryItem(e),this.setActiveItemId(null)},dismiss:e=>{this._dismissSummaryItem(e),this.setActiveItemId(null)},like:(e,t)=>{this._rateSummaryItem(e,rt.DE.liked),this.openFeedbackDialogFromPanelExpanded({kind:"readerSummaryItemMenu",itemId:e.itemId,action:"like"},t)},dislike:(e,t)=>{this._rateSummaryItem(e,rt.DE.disliked),this.openFeedbackDialogFromPanelExpanded({kind:"readerSummaryItemMenu",itemId:e.itemId,action:"like"},t)}}}_createQuestionItemActionsHandler(){return{pin:(e,t)=>{this._pinQuestionItem(e,t),this.setActiveItemId(null)},copy:e=>{this._copyQuestionItem(e),this.setActiveItemId(null)},dismiss:e=>{this._dismissQuestionItem(e),this.setActiveItemId(null)},like:(e,t)=>{this._rateQuestionItem(e,rt.DE.liked),this.openFeedbackDialogFromPanelExpanded({kind:"readerQuestionItemMenu",itemId:e.itemId,action:"like"},t)},dislike:(e,t)=>{this._rateQuestionItem(e,rt.DE.disliked),this.openFeedbackDialogFromPanelExpanded({kind:"readerQuestionItemMenu",itemId:e.itemId,action:"like"},t)}}}_createPersonItemActionsHandler(){return{pin:(e,t)=>{this._pinPersonItem(e,t),this.setActiveItemId(null)},copy:e=>{this._copyPersonItem(e),this.setActiveItemId(null)},dismiss:e=>{this._dismissPersonItem(e),this.setActiveItemId(null)},like:(e,t)=>{this._ratePersonItem(e,rt.DE.liked),this.openFeedbackDialogFromPanelExpanded({kind:"readerPersonItemMenu",itemId:e.email,action:"like"},t)},dislike:(e,t)=>{this._ratePersonItem(e,rt.DE.disliked),this.openFeedbackDialogFromPanelExpanded({kind:"readerPersonItemMenu",itemId:e.email,action:"like"},t)}}}_createLinkItemActionsHandler(){return{pin:(e,t)=>{this._pinLinkItem(e,t),this.setActiveItemId(null)},copy:e=>{this._copyLinkItem(e),this.setActiveItemId(null)},dismiss:e=>{this._dismissLinkItem(e),this.setActiveItemId(null)},like:(e,t)=>{this._rateLinkItem(e,rt.DE.liked),this.openFeedbackDialogFromPanelExpanded({kind:"readerLinkItemMenu",itemId:e.url,action:"like"},t)},dislike:(e,t)=>{this._rateLinkItem(e,rt.DE.disliked),this.openFeedbackDialogFromPanelExpanded({kind:"readerLinkItemMenu",itemId:e.url,action:"like"},t)}}}_pinQuestionItem(e,t){this._state.modify((n=>({...n,annotations:(0,o.zG)(n.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,pinned:t}))),g.getOrElse((()=>(0,o.zG)(n.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,pinned:t})))))}))),this._actions.updateAnnotationItem({...e,pinned:t}),this._gnar.readerMailPanelQuestionItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}_pinSummaryItem(e,t){this._state.modify((n=>({...n,summaryItems:(0,o.zG)(n.summaryItems,r.cq(la.h.Id.eq)(e.itemId,(e=>({...e,pinned:t}))),g.getOrElse((()=>(0,o.zG)(n.summaryItems,r.ZQ(la.h.Id.eq)(e.itemId,{...e,pinned:t})))))}))),this._actions.updateSummaryItem({...e,pinned:t}),this._gnar.readerMailPanelSummaryItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}_pinPersonItem(e,t){this._state.modify((n=>({...n,people:(0,o.zG)(n.people,r.cq(na.G.eq)(e.email,(n=>({...n,messagePinnedFrom:t?g.some(e.message):g.none,pinned:t}))),g.getOrElse((()=>(0,o.zG)(n.people,r.ZQ(na.G.eq)(e.email,{...e,messagePinnedFrom:t?g.some(e.message):g.none,pinned:t})))))}))),this._actions.updatePersonItem({...e,pinned:t,messagePinnedFrom:t?g.some(e.message):g.none}),this._gnar.readerMailPanelPersonItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}_pinLinkItem(e,t){this._state.modify((n=>({...n,links:(0,o.zG)(n.links,r.cq(ca._T.eq)(e.url,(n=>({...n,messagePinnedFrom:t?g.some(e.message):g.none,pinned:t}))),g.getOrElse((()=>(0,o.zG)(n.links,r.ZQ(ca._T.eq)(e.url,{...e,messagePinnedFrom:t?g.some(e.message):g.none,pinned:t})))))}))),this._actions.updateLinkItem({...e,messagePinnedFrom:t?g.some(e.message):g.none,pinned:t}),this._gnar.readerMailPanelLinkItemPin(e.message.id,this._sessionUuid,t,this._maybeThreadId)}_rateSummaryItem(e,t){this._state.modify((n=>({...n,summaryItems:(0,o.zG)(n.summaryItems,r.cq(la.h.Id.eq)(e.itemId,(e=>({...e,rating:t}))),g.getOrElse((()=>(0,o.zG)(n.summaryItems,r.ZQ(la.h.Id.eq)(e.itemId,{...e,rating:t})))))}))),this._actions.updateSummaryItem({...e,rating:t})}_rateQuestionItem(e,t){this._state.modify((n=>({...n,annotations:(0,o.zG)(n.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,rating:t}))),g.getOrElse((()=>(0,o.zG)(n.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,rating:t})))))}))),this._actions.updateAnnotationItem({...e,rating:t})}_ratePersonItem(e,t){this._state.modify((n=>({...n,people:(0,o.zG)(n.people,r.cq(na.G.eq)(e.email,(e=>({...e,rating:t}))),g.getOrElse((()=>(0,o.zG)(n.people,r.ZQ(na.G.eq)(e.email,{...e,rating:t})))))}))),this._actions.updatePersonItem({...e,rating:t})}_rateLinkItem(e,t){this._state.modify((n=>({...n,links:(0,o.zG)(n.links,r.cq(ca._T.eq)(e.url,(e=>({...e,rating:t}))),g.getOrElse((()=>(0,o.zG)(n.links,r.ZQ(ca._T.eq)(e.url,{...e,rating:t})))))}))),this._actions.updateLinkItem({...e,rating:t})}_copyQuestionItem(e){this._subscriptions.add(oa.D(ga(e.text)).subscribe()),this._gnar.readerMailPanelQuestionItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}_copySummaryItem(e){this._subscriptions.add(oa.D(ga(e.text)).subscribe()),this._gnar.readerMailPanelSummaryItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}_copyPersonItem(e){this._subscriptions.add(oa.D(ga(e.email)).subscribe()),this._gnar.readerMailPanelPersonItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}_copyLinkItem(e){this._subscriptions.add(oa.D(ga(e.name)).subscribe()),this._gnar.readerMailPanelLinkItemCopy(e.message.id,this._sessionUuid,this._maybeThreadId)}_dismissQuestionItem(e){this._state.modify((t=>({...t,annotations:(0,o.zG)(t.annotations,r.cq(m.p.Id.eq)(e.itemId,(e=>({...e,dismissed:!0}))),g.getOrElse((()=>(0,o.zG)(t.annotations,r.ZQ(m.p.Id.eq)(e.itemId,{...e,dismissed:!0})))))}))),this._actions.updateAnnotationItem({...e,dismissed:!0}),this._gnar.readerMailPanelQuestionItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}_dismissSummaryItem(e){this._state.modify((t=>({...t,summaryItems:(0,o.zG)(t.summaryItems,r.cq(la.h.Id.eq)(e.itemId,(e=>({...e,dismissed:!0}))),g.getOrElse((()=>(0,o.zG)(t.summaryItems,r.ZQ(la.h.Id.eq)(e.itemId,{...e,dismissed:!0})))))}))),this._actions.updateSummaryItem({...e,dismissed:!0}),this._gnar.readerMailPanelSummaryItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}_dismissPersonItem(e){this._state.modify((t=>({...t,people:(0,o.zG)(t.people,r.cq(na.G.eq)(e.email,(e=>({...e,dismissed:!0}))),g.getOrElse((()=>(0,o.zG)(t.people,r.ZQ(na.G.eq)(e.email,{...e,dismissed:!0})))))}))),this._actions.updatePersonItem({...e,dismissed:!0}),this._gnar.readerMailPanelPersonItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}_dismissLinkItem(e){this._state.modify((t=>({...t,links:(0,o.zG)(t.links,r.cq(ca._T.eq)(e.url,(e=>({...e,dismissed:!0}))),g.getOrElse((()=>(0,o.zG)(t.links,r.ZQ(ca._T.eq)(e.url,{...e,dismissed:!0})))))}))),this._actions.updateLinkItem({...e,dismissed:!0}),this._gnar.readerMailPanelLinkItemDismiss(e.message.id,this._sessionUuid,this._maybeThreadId)}setActiveItemId(e){this._state.modify((t=>({...t,activeMenuItemId:g.fromNullable(e)})))}openFeedbackDialogFromPanelCollapsed(e,t){this._state.modify((n=>((0,ta.hu)("collapsed"===n.panelState),{...n,feedbackDialog:g.some({source:e,position:t})})))}openFeedbackDialogFromPanelExpanded(e,t){this._state.modify((n=>((0,ta.hu)("expanded"===n.panelState),{...n,feedbackDialog:g.some({source:e,position:t})})))}closeFeedbackDialog(e){this._state.modify((e=>({...e,feedbackDialog:g.none,activeMenuItemId:g.none})))}skipFeedbackDialog(e){this._state.modify((e=>({...e,feedbackDialog:g.none,activeMenuItemId:g.none})))}submitFeedbackDialog(e,t,n){this._state.modify((e=>({...e,feedbackDialog:g.none,activeMenuItemId:g.none,notification:g.some(Yi.create(Ji.thankYou))})))}closeNotification(){this._state.modify((e=>({...e,notification:g.none})))}onLinkItemClick(e){this._gnar.readerMailPanelLinkItemClick(e.message.id,this._sessionUuid,this._maybeThreadId)}dispose(){this._subscriptions.unsubscribe()}_autoDismissNotifications(){return sa.F(1e3).pipe(he.M(this._state),ze.h((([e,t])=>(0,o.zG)(t.notification,g.fold(o.jv,(e=>Date.now()>=e.dismissTimestamp)))))).subscribe((()=>this._state.modify((e=>({...e,notification:(0,o.zG)(e.notification,g.filter((e=>Date.now()<e.dismissTimestamp)))})))))}_trackMessageShow(){return this.state.pipe(ze.h(y),x.U((e=>e.activeView)),ze.h(k),Je.x(((e,t)=>ea.Rb.eq.equals(e.message.value,t.message.value)))).subscribe((e=>{const t=(0,o.zG)(e.summary,g.filter(p.d6),g.fold((()=>0),(e=>e.value.length))),n=(0,o.zG)(e.questions,g.filter(p.d6),g.fold((()=>0),(e=>e.value.length))),i=(0,o.zG)(e.mentions,g.filter(p.d6),g.fold((()=>0),(e=>e.value.length)));this._gnar.readerMailPanelMessageShow(Array.from(this._features),e.message.value.id,i,n,this._sessionUuid,this._userNavigatedInPanel?"navigation":"firstLoad",t,e.message.value.wordCount,"parsedDate"===e.message.value.date.kind?e.message.value.date.timestamp:void 0,this._maybeThreadId)}))}}function ba(e,t){return e.has(t)?g.some:(0,o.a9)(g.none)}function va(e,t){return t.some((t=>e.has(t)))?g.some:(0,o.a9)(g.none)}function Ia(e,t){return(0,o.zG)(e,g.fold((()=>p.x5),(e=>(0,o.zG)(a.Y(p.$w)({summary:e.summary,message:e.message}),p.UI((({summary:e,message:n})=>(0,o.zG)(e,g.fold((()=>[]),(0,o.ls)(re.ei("summary"),s.UI((e=>{var i,a;const o=la.h.Id.create(e.id),s=t.get(o);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:o,text:e.text,pinned:null!==(i=null==s?void 0:s.pinned)&&void 0!==i&&i,dismissed:null!==(a=null==s?void 0:s.dismissed)&&void 0!==a&&a,rating:null==s?void 0:s.rating}})),s.hX((e=>!e.dismissed)))))))))))}function ka(e,t){return(0,o.zG)(e,g.fold((()=>p.x5),(e=>(0,o.zG)(a.Y(p.$w)({annotations:e.annotations,message:e.message}),p.UI((({annotations:e,message:n})=>(0,o.zG)(e,g.fold((()=>[]),(0,o.ls)(re.ei("annotations"),s.UI((e=>{var i,a,o;const s=m.p.Id.create(e.id),r=t.get(s);return{message:{id:n.id,author:n.author,date:n.date,index:n.index},itemId:s,text:e.text,type:e.type,pinned:null!==(i=null==r?void 0:r.pinned)&&void 0!==i&&i,checked:null!==(a=null==r?void 0:r.checked)&&void 0!==a&&a,dismissed:null!==(o=null==r?void 0:r.dismissed)&&void 0!==o&&o,rating:null==r?void 0:r.rating}})),s.hX((e=>!e.dismissed)),s.hX((e=>"question"===e.type||"action_item"===e.type)))))))))))}function ya(e,t,n){return(0,o.zG)(e,g.fold((()=>p.x5),(e=>(0,o.zG)(e.message,p.tS((e=>(0,o.zG)(e.audience,Xi.c2,g.fold((()=>p.kH(new ha.ZS("No audience"))),(i=>p.Vp((0,o.zG)(i,s.UI((i=>{var a,s,r;const l=t.get(i.email);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(a=null==l?void 0:l.messagePinnedFrom)&&void 0!==a?a:g.none,name:(0,o.zG)(_a(i,n),g.toUndefined),email:i.email,avatarUrl:(0,o.zG)(n,g.chain((e=>g.fromNullable(e.get(i.email)))),g.chain((e=>g.fromNullable(e.avatarUrl)))),pinned:null!==(s=null==l?void 0:l.pinned)&&void 0!==s&&s,dismissed:null!==(r=null==l?void 0:l.dismissed)&&void 0!==r&&r,rating:null==l?void 0:l.rating}})),s.hX((e=>!e.dismissed)))))))))))))}function xa(e,t){return(0,o.zG)(e,g.fold((()=>p.x5),(e=>(0,o.zG)(e.message,p.tS((e=>p.Vp(e.links.map((n=>{var i,a,o;const s=t.get(n.url);return{message:{id:e.id,author:e.author,date:e.date,index:e.index},messagePinnedFrom:null!==(i=null==s?void 0:s.messagePinnedFrom)&&void 0!==i?i:g.none,name:n.name,url:n.url,type:n.type,mimeType:ea.q7.isAttachment(n)?n.mimeType:void 0,pinned:null!==(a=null==s?void 0:s.pinned)&&void 0!==a&&a,dismissed:null!==(o=null==s?void 0:s.dismissed)&&void 0!==o&&o,rating:null==s?void 0:s.rating}})).filter((e=>!e.dismissed)))))))))}function _a(e,t){return(0,o.zG)(t,g.chain((t=>g.fromNullable(t.get(e.email)))),g.chain((e=>g.fromNullable(e.name))),lt.vx(g.fromNullable(e.name)))}!function(e){e.mock=function(e){return{pin:o.Q1,copy:o.Q1,dismiss:o.Q1,like:(t,n)=>e(t,"like",n),dislike:(t,n)=>e(t,"dislike",n)}}}(ua||(ua={})),function(e){e.Mock=class{constructor(e,t=!0){this._state=e,this.isFeedbackSupported=t,this.browser="chrome",this.isClipboardSupported=!0,this.state=this._state.view(),this.collapseButtonClick=o.Q1,this.expandButtonClick=o.Q1,this.optIn=o.Q1,this.optOut=o.Q1,this.onboardingShow=o.Q1,this.onboardingViewNavigate=o.Q1,this.threadViewNavigate=o.Q1,this.openPinnedView=o.Q1,this.openMessageView=o.Q1,this.checkQuestionItem=o.Q1,this.closeNotification=o.Q1,this.summaryItemActions=ua.mock(((e,t,n)=>this.openFeedbackDialogFromPanelExpanded({kind:"readerSummaryItemMenu",itemId:e.itemId,action:t},n))),this.questionItemActions=ua.mock(((e,t,n)=>this.openFeedbackDialogFromPanelExpanded({kind:"readerQuestionItemMenu",itemId:e.itemId,action:t},n))),this.personItemActions=ua.mock(((e,t,n)=>this.openFeedbackDialogFromPanelExpanded({kind:"readerPersonItemMenu",itemId:e.email,action:t},n))),this.linkItemActions=ua.mock(((e,t,n)=>this.openFeedbackDialogFromPanelExpanded({kind:"readerLinkItemMenu",itemId:e.url,action:t},n))),this.recapExpandButtonClick=o.Q1,this.recapCollapseButtonClick=o.Q1,this.panelShow=o.Q1,this.onLinkItemClick=o.Q1}openFeedbackDialogFromPanelCollapsed(e,t){this._updateFeedback(g.some({source:e,position:t}))}openFeedbackDialogFromPanelExpanded(e,t){this._updateFeedback(g.some({source:e,position:t}))}closeFeedbackDialog(){this._updateFeedback(g.none)}skipFeedbackDialog(){this._updateFeedback(g.none)}submitFeedbackDialog(){this._updateFeedback(g.none)}setActiveItemId(e){this._state.modify((t=>y(t)?{...t,activeView:{...t.activeView,activeMenuItemId:g.fromNullable(e)}}:t))}_updateFeedback(e){this._state.modify((t=>"expanded"===t.kind&&"onboardingView"!==t.activeView.kind?{...t,activeView:{...t.activeView,activeMenuItemId:g.isNone(e)?g.none:t.activeView.activeMenuItemId},feedbackDialog:(0,o.zG)(e,g.filter(Qe.isExpandedPanel))}:"collapsed"===t.kind?{...t,feedbackDialog:(0,o.zG)(e,g.filter(Qe.isCollapsedPanel))}:t))}}}(pa||(pa={}));var Ea,wa=n(90361),Ua=n(74850),Ca=n(19751),Na=n(23063),Sa=n(24209),Ma=n(17343),Ga=n(16118),Fa=n(78674),Ta=n(71032),za=n(85321),Aa=n(67434),Pa=n(73975);!function(e){let t;!function(e){e.create=function(e,t){return`${e}|${t}`}}(t=e.Id||(e.Id={}))}(Ea||(Ea={}));var La=n(25691);class Da{constructor(e=Ua.Y.create("Reader-Card-Controller")){this._logger=e,this._hovered=new pe.xQ,this._dismissed=new pe.xQ,this.cardHovered=this._hovered.pipe((0,W.O)(!1),(0,Je.x)()),this.cardDismissed=this._dismissed.pipe((0,Je.x)()),this._activeCardModel=q.h.create(null),this.view=(0,B.aj)([this._activeCardModel]).pipe((0,x.U)((([e])=>(null==e?void 0:e.annotation)?u.createElement(La.W,{anchorRect:e.highlightRect},u.createElement("div",{style:{background:"white",borderRadius:10,padding:10,fontSize:"12px",fontFamily:"sans-serif",boxShadow:"0px 2px 10px rgba(0, 0, 0, 0.6)"}},u.createElement("b",null,"Annotation"),u.createElement("pre",{style:{maxWidth:400,whiteSpace:"pre-wrap"}},JSON.stringify(e.annotation,null,4)))):null))),this._logger.debug("Created")}show(e){this._activeCardModel.set(e)}hide(){this._activeCardModel.set(null),this._hovered.next(!1)}dispose(){this.hide()}}var Ra=n(34311);class Va{constructor(e){this._annotationsStateService=e}getHoveredStateBehavior(e){return this._annotationsStateService.getHighlightedAnnotation().pipe((0,x.U)((t=>t&&t.highlightIds.includes(e)?Ra.pc.hovered:Ra.pc.none)))}}var Oa,Ba=n(50628),Za=n(24755),Ha=n(95300),qa=n(95343),ja=n(11407),Ka=n(28728),Qa=n(15555),$a=n(13718);!function(e){e.eq=Pa.f7(((e,t)=>e&&t?e.annotationId===t.annotationId:e===t))}(Oa||(Oa={}));class Wa{constructor(e,t=Ua.Y.create(Wa.name)){this._options=e,this._log=t,this._rawHighlightedAnnotation=()=>this._options.mouseData.pipe($a.U(ja.S.hz30),Ca.skipBy(Ka.Z.eq),x.U((({client:e,offset:t})=>{if(e&&t&&function(e,t){var n;let i=t.ownerDocument.elementFromPoint(e.left,e.top);(null===(n=null==i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint)&&(i=i.shadowRoot.elementFromPoint(e.left,e.top));return t.contains(i)}(e,this._options.textNode)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((n,i)=>{const a=e.get(i);if(a){const e=a.rects&&(null===a.meta.highlightDisplayFormat||Qa.jk.isInteractable(a.meta.highlightDisplayFormat))&&a.rects.find((e=>$e.UL.contains(t,e)));if(e)return{annotationId:a.meta.annotationId,activeHighlightId:a.meta.highlightId,activeHighlightRect:e,highlightIds:[]}}return n}),null)}return null})),Ca.skipBy(Oa.eq),x.U((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),n=[];return t.forEach(((t,i)=>{t.meta.annotationId===e.annotationId&&n.push(i)})),{...e,highlightIds:n}}))),this._offByUpdatedGeometry=e=>this._options.highlightGeometry.geometry.pipe(x.U((t=>e&&t.has(e.activeHighlightId)?e:null)),ze.h((e=>null===e)),Ma.h(null),ge.b((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextPositionChange=()=>Sa.T(this._options.textNodeLayout.rect.changes.pipe(ge.b((()=>this._log.trace("Text field position, size has been changed")))),this._options.textNodeLayout.scroll.changes.pipe(ge.b((()=>this._log.trace("Text field scroll has been changed")))),Ae.R(self,"scroll").pipe(ge.b((()=>this._log.trace("Window scroll detected"))))).pipe(Ba.P(),Ma.h(null))}getActiveAnnotation(){throw new Error("Not implemented")}getHighlightedAnnotation(){throw new Error("Not implemented")}}class Ja extends Wa{constructor(e,t=Ua.Y.create(Ja.name)){super(e,t)}getActiveAnnotation(){return this.getHighlightedAnnotation().pipe(Ca.skipBy(Oa.eq))}getHighlightedAnnotation(){return this._rawHighlightedAnnotation().pipe(Ca.skipBy(Oa.eq),Ye.w((e=>e?Sa.T(this._offByUpdatedGeometry(e),this._offByTextPositionChange()).pipe(ge.b((()=>this._log.trace("Active state was overriden by text or geometry change"))),Ba.P(),W.O(e)):U.of(null))),Ca.skipBy(Oa.eq),Za.O(new Ha.X(null)),qa.x())}}var Ya=n(93356),Xa=n(76331),eo=n(40327),to=n(10166),no=n(71249),io=n(4432);class ao{constructor(){}create(e,t){return{getRects:()=>{var n;const i=[];let a,o=e.start,s=!1;do{const r=t.getFragmentAtOrBeforeOffset(o);if(r&&a!==o){a=o;if(null===(n=r.node.textContent)||void 0===n?void 0:n.replace(/\s/g,"")){const n=io.M.createRange(t,o,Math.min(r.endOffset,e.end));n&&i.push(...Array.from(n.getClientRects()))}o=r.endOffset===o?r.endOffset+1:r.endOffset}else s=!0}while(o<e.end&&!s);return(0,eo.pipe)(i,to.e,to.y,no.UI($e.Pf.create))}}}getClientRects(e){return e.getRects()}getIsInvalid(e){return!1}getIsConsistent(e,t,n){return!0}dispose(e){}}var oo=n(13116),so=n(28094),ro=n(95981),lo=n(63919),co=n(25924),mo=n(18505),uo=n(2780),po=n(68383),ho=n(92783),go=n(57356),fo=n(51655),bo=n(70718),vo=n(13822);function Io(e,t,n,i=!1){const a=(0,fo.Me)(e).body,o=(0,fo.Jj)(e);let s={left:"0px",top:"0px"};if(t.fieldPaintingPositioning===go.Q.nonPositioned&&t.positionedAncestor===a){const e=o.getComputedStyle(a);s={left:e.marginLeft||"0px",top:e.marginRight||"0px"}}else if(t.positionedAncestor!==a){const e=o.getComputedStyle(t.positionedAncestor);s={left:e.borderLeftWidth&&`-${e.borderLeftWidth}`||"0px",top:e.borderTopWidth&&`-${e.borderTopWidth}`||"0px"}}return a=>{a.style.position="absolute",a.style.top=s.top,a.style.left=i?"auto":s.left,a.style.right=i?s.left:"auto",a.style.pointerEvents="none",function({subjectElement:e,isPositioned:t,subjectElementStyle:n,integrationRoot:i,positionedAncestor:a}){t?(i.style.zIndex=n.zIndex,e.insertAdjacentElement("afterend",i)):a.insertAdjacentElement("afterbegin",i)}({subjectElement:e,isPositioned:t.fieldPaintingPositioning===go.Q.positioned,subjectElementStyle:n,integrationRoot:a,positionedAncestor:t.positionedAncestor})}}function ko(e){return $e.Pf.create({...e.client,...e.size})}class yo{constructor(e){this._highlightsSubject=e,this.getFieldPositionRelativeToViewport=()=>{const e=this._highlightsSubject.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}},this._prepareHighlights=(e,t=(0,fo.is)(e))=>{const n=(0,fo.o)(e),i=(0,bo.fL)(e,!1,n,t);return{layout:i,rootInjector:Io(e,i,n),enableHighlightsBlendingOnRoot:(0,so.$)(e,n)}},this._prepareInnerElements=(e,t=(0,fo.is)(e),n)=>{const i=(0,fo.o)(e),a=n||(0,bo.fL)(e,!1,i,t);return{layout:a,rootInjector:Io(e,a,i,!0)}},this._highlights=this._prepareHighlights(this._highlightsSubject),this._innerElements=this._prepareInnerElements(this._highlightsSubject,void 0,this._highlights.layout),this._win=(0,fo.Jj)(this._highlightsSubject),this._createTextNodeRect=e=>({page:lo.Cv.fromClient(e.client,{top:this._win.scrollY,left:this._win.scrollX}),offset:e.offset,client:e.client,size:e.size,padding:e.padding}),this.textNode={rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),visibleRect:this._highlights.layout.textField.visibleRect.map(this._createTextNodeRect),scroll:this._highlights.layout.textField.scroll,scrollSize:this._highlights.layout.textField.scrollSize,scroller:(0,c.iX)(this._highlightsSubject,{rect:this._highlights.layout.textField.paddingRect.map(this._createTextNodeRect),scrollSize:this._highlights.layout.textField.scrollSize})},this.highlightHeightOffset=0,this.mouse=(0,B.aj)([this._highlights.layout.textField.paddingRect.behavior,this._highlights.layout.textField.scroll.behavior]).pipe((0,x.U)((([e,t])=>({rect:ko(e),scroll:t}))),(0,Ye.w)((({rect:e,scroll:t})=>(0,ho.Am)()?(0,co.q7)(this._win,e,t):(0,co.B0)(this._win,e,t))),(0,Je.x)(wa.fS))}createGeometryLayout(){return new ro.D((()=>ko(this._highlights.layout.textField.paddingRect.getCurrent())),(()=>this._highlights.layout.textField.scroll.getCurrent()),(()=>ko(this._highlights.layout.textField.paddingRect.getApproximate())),(()=>this._highlights.layout.textField.scroll.getApproximate()))}render(e,t){const n={position:"absolute",top:0,left:0},i={position:"absolute",top:0,right:0},a=()=>e.innerElements?u.createElement(e.innerElements,null):null,o=(0,fo.Me)(this._highlightsSubject),s=mo.VB.get({monitorAs:"highlights"}).inject(uo.EM.fromDocument(o,"grammarly-extension"),(e=>{t.highlightsBlendingEnabled&&this._highlights.enableHighlightsBlendingOnRoot(e),this._highlights.rootInjector(e)}),po.G7.showWhenLoaded(u.createElement((()=>u.createElement(u.Fragment,null,e.highlights&&u.createElement("div",{"data-grammarly-part":"highlights",style:n},u.createElement(vo.V,{layout:this._highlights.layout},u.createElement("div",{style:n},u.createElement(e.highlights,null)))))),null))),r=mo.VB.get({monitorAs:"inner-elements"}).inject(uo.EM.fromDocument(o,"grammarly-extension"),this._innerElements.rootInjector,po.G7.showWhenLoaded(u.createElement((()=>e.innerElements?u.createElement("div",{"data-grammarly-part":"inner-elements",style:i},u.createElement(a,null)):null),null))),l=e.outerElements&&mo.VB.get({monitorAs:"outer-elements"}).inject(uo.EM.fromDocument(o,"grammarly-popups"),uo.zs.appendChild(o.documentElement),po.G7.showWhenLoaded(u.createElement(e.outerElements,null)),{eventPropagationHandler:t.eventPropagationHandler});return{dispose:()=>{s&&s.dispose(),l&&l.dispose(),r&&r.dispose()}}}}var xo,_o=n(95093),Eo=n(43675),wo=n(92843),Uo=n(37881),Co=n(22679),No=n(87965),So=n(50663),Mo=n(48189),Go=n(49468);class Fo{constructor(e,t,n,i){this._layout=e,this._highlights=t,this._annotationCards=n,this._getHoveredStateBehavior=i,this._highlightHoverStateBehavior=e=>this._getHoveredStateBehavior(e),this._getHighlightsContainer=e=>u.createElement(_.F.div,{style:this._layout.textNode.scrollSize.behavior.pipe((0,x.U)((e=>({height:e.height,width:e.width}))))},e),this.highlights=()=>this._getHighlightsContainer(u.createElement(u.Fragment,null,u.createElement(Uo.$v,{key:"aqua-highlights",highlightHeightOffset:0,highlights:this._highlights.geometry.view((e=>Array.from(e.values()))),getHoverState:this._highlightHoverStateBehavior}))),this.outerElements=()=>{const e=this._annotationCards;return u.createElement(Go.o,{style:{zIndex:Co.op,position:"absolute",top:0,left:0,width:"100%"}},u.createElement(No.p,null,u.createElement("div",{style:{position:"fixed",visibility:"hidden"}}),u.createElement(_.F.Fragment,null,e),u.createElement(So.G,null),u.createElement(Mo.p,{regular:!0,bold:!0})))}}}!function(e){e.eqByAnnotations=Pa.Uz((e=>({annotations:e.annotations,messageId:e.messageId})))(Pa.MW({messageId:Pa.yv,annotations:no.Eh(ea.be.eq)}))}(xo||(xo={}));class To{constructor(e,t,n=Ua.Y.create("Reader-Gmail-Annotations")){this._annotatedMessages=e,this._logger=n,this._subscriptions=new aa.w,this._currentAnnotations=new Map,this._geometryProvider=new ao,this._state=new Map,this._bodyNodeToMessageId=new WeakMap,this._annotationIdsForMessageId=new Map,this._hiddenMessages=new WeakMap;const i=new pe.xQ,a=this._annotatedMessages.pipe(W.O(new Map),Ga.G(),x.U((([e,t])=>(0,o.zG)(Eo.yi(xo.eqByAnnotations)(e,t),wo.v.reduce([],((e,{messageId:t})=>e.concat({kind:"remove",messageId:t})),((e,t,n)=>e.concat({kind:"update",prevAnnotations:t.annotations,...n})),((e,t)=>e.concat({kind:"add",...t})))))),za.zg(o.yR),_o.T(i));this._intersectionObserver=new IntersectionObserver((e=>{e.map((e=>{e.isIntersecting?(0,o.zG)(g.fromNullable(this._hiddenMessages.get(e.target)),lt.bw((t=>{this._hiddenMessages.delete(e.target),i.next({kind:"add",...t})}))):(0,o.zG)(g.fromNullable(this._bodyNodeToMessageId.get(e.target)),g.chain((e=>g.fromNullable(this._state.get(e)))),lt.bw((({message:t})=>{const{messageId:n,bodyNode:a}=t;i.next({kind:"remove",messageId:n}),this._hiddenMessages.set(e.target,t),this._intersectionObserver.observe(a)})))}))}),{root:t}),this._subscriptions.add(a.subscribe((e=>{const t=this._state.get(e.messageId);if(t&&("update"===e.kind?e.prevAnnotations.forEach((t=>{const n=Ea.Id.create(e.messageId,function(e){return`${e.span.s}-${e.span.e}-${e.type}`}(t));this._currentAnnotations.delete(n),(0,o.zG)(g.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),lt.bw((e=>{e.delete(n)})))})):"remove"===e.kind&&((0,o.zG)(g.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),lt.bw((e=>{for(const t of e.values())this._currentAnnotations.delete(t)}))),this._annotationIdsForMessageId.delete(e.messageId),this._bodyNodeToMessageId.delete(t.message.bodyNode),this._state.delete(e.messageId)),t.disposables.forEach((e=>e.dispose())),this._logger.trace(`Annotations for ${e.messageId} cleared`)),"add"===e.kind||"update"===e.kind){const t=new Da,n=new yo(e.bodyNode),i=new Xa.C(this._geometryProvider,n.createGeometryLayout(),(()=>e.textMap),(0,Ya.u)(),(0,Ra.WF)(n.textNode)),a=new Ja({textNode:e.bodyNode,textNodeLayout:n.textNode,mouseData:n.mouse,highlightGeometry:i}),s=new Va(a),r=a.getActiveAnnotation().subscribe((e=>{if(e){const i=this._currentAnnotations.get(e.annotationId);i&&t.show({highlightRect:(0,oo.Z)(e.activeHighlightRect,n.textNode.rect.getApproximate().client,n.textNode.scroll.getApproximate()),annotation:i})}else t.hide()})),l=new Fo(n,i,t.view,(e=>s.getHoveredStateBehavior(e)));this._intersectionObserver.observe(e.bodyNode),this._state.set(e.messageId,{message:e,disposables:[{dispose:()=>r.unsubscribe()},i,n.render(l,{}),t,{dispose:()=>this._intersectionObserver.unobserve(e.bodyNode)}]}),this._bodyNodeToMessageId.set(e.bodyNode,e.messageId);const d=(0,o.zG)(g.fromNullable(this._annotationIdsForMessageId.get(e.messageId)),g.getOrElse((()=>{const t=new Set;return this._annotationIdsForMessageId.set(e.messageId,t),t})));e.annotations.forEach((t=>{const n=`${t.span.s}-${t.span.e}-${t.type}`,a=Ra.y$.Id.create(e.messageId,n),o=Ea.Id.create(e.messageId,n);this._logger.trace("Adding annotation highlight",a),this._currentAnnotations.set(o,t),d.add(o),i.addHighlight(a,{start:t.span.s,end:t.span.e},{highlightId:a,annotationId:o,highlightColor:Qa.hE.Preset.create(Qa.al.gray),highlightDisplayFormat:Qa.jk.underlineAndBackground})}))}})))}dispose(){this._subscriptions.unsubscribe();for(const{disposables:e}of this._state.values())e.forEach((e=>e.dispose()));this._currentAnnotations.clear(),this._state.clear(),this._annotationIdsForMessageId.clear(),this._intersectionObserver.disconnect()}}var zo=n(85089),Ao=n(89068),Po=n(91224),Lo=n(73572),Do=n(18347),Ro=n(44586),Vo=n(17733),Oo=n(79582);function Bo(e,t){return new Ro.y((function(n){var i=e.length;if(0!==i)for(var a=new Array(i),o=0,s=0,r=function(r){var l=(0,oa.D)(e[r]),d=!1;n.add(l.subscribe({next:function(e){d||(d=!0,s++),a[r]=e},error:function(e){return n.error(e)},complete:function(){++o!==i&&d||(s===i&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},l=0;l<i;l++)r(l);else n.complete()}))}var Zo=n(30625),Ho=n(16169),qo=n(44923),jo=n(84603),Ko=n(66319),Qo=n(75420),$o=n(58028),Wo=n(66081),Jo=n(24713),Yo=n(40151),Xo=n(38062),es=n(80900),ts=n(38194),ns=n(81407),is=n(78146),as=n(44212),os=n(86400);function ss(e){return e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function rs(e){const t=e.match(/(?<name>.*?)\s*<(?<email>.*?)>/);if(null==t?void 0:t.groups){const e=t.groups.email,n=t.groups.name;return(0,o.zG)(na.G.create(e),ra.Yo((()=>"No email address found")),ra.UI((e=>({email:e,name:(0,o.zG)(n,ss,(e=>""===e?void 0:e))}))))}return(0,o.zG)(na.G.create(e.trim()),g.map((e=>({name:void 0,email:e}))),ra.Yo((()=>`Malformed user [${e}]`)))}function ls(e){const t=e.includes("<")&&e.includes(">");return(0,o.zG)(t?e.split(/>\s*,\s*/):e.split(/\s*,\s*/),(e=>e.length>1&&t?e.map((e=>e+">")):e),no.hX((e=>!e.match(/^undisclosed/))),no.UI(rs),no.IX.sequence(ra.wE))}function ds(e){try{const t=e.split(/\n{2,}/)[0];return t?(0,o.zG)(function(e){const t=e.split(/\n+/),n=[];for(const e of t)if(/^\s+/.test(e))n.length>0&&(n[n.length-1].value+=e.trimStart());else{const t=e.match(/(.*?):\s*(.*)/);t&&t.length>=3&&n.push({header:String(t[1]).toLowerCase(),value:t[2]})}return n.reduce(((e,{header:t,value:n})=>({...e,[t]:n})),{})}(t),(e=>{var t,n,i,s;return a.Y(ra.wE)({id:(0,o.zG)(null===(n=null===(t=e["message-id"])||void 0===t?void 0:t.match(/<(.*?)>/))||void 0===n?void 0:n[1],ra.ij("No Message-ID header")),inReplyTo:ra.F2(null===(s=null===(i=e["in-reply-to"])||void 0===i?void 0:i.match(/<(.*?)>/))||void 0===s?void 0:s[1]),date:(0,o.zG)(e.date,ra.ij("No Date header"),ra.UI((e=>new Date(e)))),from:(0,o.zG)(e.from,ra.ij("No From header"),ra.tS(rs)),to:(0,o.zG)(e.to,ra.ij("No To header"),ra.tS(ls)),cc:(0,o.zG)(e.cc,(e=>e?ls(e):ra.F2(void 0))),bcc:(0,o.zG)(e.bcc,(e=>e?ls(e):ra.F2(void 0))),subject:(0,o.zG)(e.subject,ra.ij("No Subject header")),deliveredTo:(0,o.zG)(e["delivered-to"],ra.F2),replyTo:(0,o.zG)(e["reply-to"],(e=>e?ls(e):ra.F2(void 0))),listUnsubscribe:(0,o.zG)(e["list-unsubscribe"],(e=>e?function(e){const t=(0,os.rL)(e,/<([^<>]+)>/g,(e=>e[1]));return t.length?t:void 0}(e):void 0),ra.F2),headers:ra.F2(e)})})):ra.t$("Expected headers")}catch(e){return ra.t$(String(e))}}async function cs(e,t,n){const i=await async function(e,t,n){var i,a,o,s;const r=(null===(a=null===(i=/^(?<url>.*?)\/?[#\?]/.exec(e))||void 0===i?void 0:i.groups)||void 0===a?void 0:a.url)||"https://mail.google.com/mail/u/0";try{const e=await fetch(`${r}/?ik=${encodeURIComponent(t)}&view=om&permmsgid=${encodeURIComponent(n)}`),i=await e.text(),a=null===(s=null===(o=/<pre[\s\S]*?id="raw_message_text"[\s\S]*?>(?<orig_msg>[\s\S]*?)<\/pre>/m.exec(i))||void 0===o?void 0:o.groups)||void 0===s?void 0:s.orig_msg;return a?ra.ij({message:"Could not decode message"})((0,Zo.l_)(a.trim())):ra.t$({message:"Could not extract message from response",mimeMessageNotFound:!0})}catch(e){return ra.t$({message:String(e)})}}(n,t,e);return(0,o.zG)(i,ra.tS((e=>(0,o.zG)(ds(e),ra.Vn((e=>({message:e})))))))}function ms(e){return!!e.messageNode&&!!e.id&&void 0!==e.index}class us{constructor(e,t,n,i,s=Ua.Y.create("Reader-Gmail-Thread-Context")){this._doc=e,this._messageList=t,this._telemetry=i,this._logger=s,this._subscriptions=new aa.w,this._state=q.h.create((0,o.zG)(function(e){const t=ra.ij(new ha.DH("Cannot find thread subject container"))(e.querySelector(Lo.Av));return{threadId:(0,o.zG)(t,ra.tS((e=>ra.ij(new ha.DH("Cannot find thread ID"))(e.getAttribute("data-thread-perm-id"))))),subject:(0,o.zG)(t,ra.tS((e=>ra.ij(new ha.DH("Cannot find thread Subject"))(e.textContent)))),loggedUser:(0,o.zG)(ra.ij(new ha.DH("Cannot extract user from avatar"))(jo.x.getAuthor()),ra.tS((t=>(0,o.zG)(na.G.create(t.email),g.map((n=>({name:t.name?t.name:void 0,email:n,avatarUrl:(0,o.zG)(g.fromNullable(e.querySelector(Lo.Dy)),g.chain(hs),g.toUndefined)}))),ra.Yo((()=>new ha.DH("No email address found in avatar")))))))}}(this._doc),(e=>({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser,avatars:(0,o.zG)(e.loggedUser,ra.g_((()=>new Map),(e=>new Map([[e.email,e]])))),messageCount:ks(this._messageList).length,expandedMessages:new Map,messageIndexToIdMap:new Map,messageNodeToIdMap:new Map})))),this.threadContext=this._state.view(),(0,o.zG)(this._state.get(),(e=>a.Y(ra.wE)({threadId:e.threadId,subject:e.subject,loggedUser:e.loggedUser})),ra.Vn((e=>{this._telemetry.readerGmail.warning("threadInfoExtraction",e.message),this._logger.warn("Static thread info extraction error",e)})));const l=Ko.x.create(this._messageList,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded","tabindex"]}).pipe(Wo.e(50),W.O(null),Ca.shareReplay({bufferSize:1,refCount:!0}));this._subscriptions.add(l.pipe(Ye.w((()=>{return e=this._doc,t=this._state.get().avatars,oa.D(e.querySelectorAll(Lo.Q$)).pipe(ze.h((e=>e instanceof HTMLImageElement)),x.U((e=>(0,o.zG)(na.G.create(e.getAttribute(Lo.zv)||void 0),g.map((t=>({email:t,name:e.getAttribute(Lo.AE)||void 0,img:e})))))),za.zg(g.fold((()=>Yo.E),(({email:e,name:t,img:n})=>{return(i=n,U.of(hs(i)).pipe(Ye.w(g.fold((()=>Xo.S3(Ae.R(i,"onload"),es.H(1e3)).pipe(x.U((()=>hs(i))))),(e=>U.of(g.some(e))))))).pipe(x.U(g.map((n=>({email:e,name:t,avatarUrl:n})))));var i}))),w.oA,Aa.R(((e,t)=>new Map(e).set(t.email,t)),new Map(t)));var e,t})),ge.b((e=>{this._state.modify((t=>({...t,avatars:e})))}))).subscribe());const d=l.pipe(x.U((e=>{const t=ks(this._messageList);return{nodes:t,expandedCount:t.filter(xs).length}})),Je.x(((e,t)=>e.nodes.length===t.nodes.length&&e.expandedCount===t.expandedCount)),Jo.j("nodes"));this._subscriptions.add(d.pipe(ge.b((e=>{this._state.modify((t=>({...t,messageCount:e.length})))})),(0,o.ls)(x.U((e=>{const t=e.map(((e,t)=>({messageNode:e,index:t}))),n=t.filter((({messageNode:e})=>xs(e))).map((({messageNode:e,index:t})=>{var n,i;return{id:null===(i=null===(n=e.querySelector(Lo.k2))||void 0===n?void 0:n.getAttribute(Lo.bq))||void 0===i?void 0:i.slice(1),messageNode:e,index:t}})).filter(ms).reduce(((e,t)=>e.set(t.id,[t.messageNode,t.index])),new Map);return{allNodes:t.reduce(((e,t)=>e.set(t.messageNode,[t.messageNode,t.index])),new Map),expandedNodes:n}})),W.O({allNodes:new Map,expandedNodes:new Map}),Ga.G(),x.U((([e,t])=>{const n=new Set(e.expandedNodes.keys()),i=new Set(t.expandedNodes.keys()),a=Array.from(Do.e5(Pa.yv)(n)(i)),o=new Set(e.allNodes.keys()),s=new Set(t.allNodes.keys()),r=Array.from(Do.e5(Pa.w4)(s)(o));return{expanded:a.map((e=>{const n=t.expandedNodes.get(e);return{id:e,messageNode:null==n?void 0:n[0],index:null==n?void 0:n[1]}})).filter(ms),removed:r.reduce(((e,t)=>(e.add(t),e)),new Set),all:t.allNodes}})),ze.h((e=>e.expanded.length>0||e.removed.size>0))),ge.b((e=>{const{expanded:t,removed:n,all:i}=e;t.length&&(this._logger.debug(`New message(s) expanded [${t.map((e=>e.id))}]`),this._state.modify((e=>{const n=(0,o.zG)(e.expandedMessages,r.UI(p.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}})))),a=t.reduce(((e,t)=>(e.set(t.id,p.x5),e)),new Map(n)),s=t.reduce(((e,t)=>(e.set(t.messageNode,t.id),e)),new Map(e.messageNodeToIdMap)),l=Array.from(i.values()).reduce(((e,[t,n])=>(s.has(t)&&e.set(n,s.get(t)),e)),new Map);return{...e,expandedMessages:a,messageIndexToIdMap:l,messageNodeToIdMap:s}}))),n.size&&(this._logger.debug(`Message(s) removed [${Array.from(n.values())}]`),this._state.modify((e=>{const t=(0,o.zG)(e.expandedMessages,r.UI(p.UI((e=>{var t,n;return{...e,index:null!==(n=null===(t=i.get(e.messageNode))||void 0===t?void 0:t[1])&&void 0!==n?n:e.index}}))),r.hX((e=>!(p.d6(e)&&n.has(e.value.messageNode))))),a=Array.from(n.values()).reduce(((e,t)=>(e.delete(t),e)),new Map(e.messageNodeToIdMap)),s=Array.from(i.values()).reduce(((e,[t,n])=>a.has(t)?e.set(n,a.get(t)):e),new Map);return{...e,expandedMessages:t,messageIndexToIdMap:s,messageNodeToIdMap:a}})))})),Jo.j("expanded"),ze.h((e=>e.length>0)),za.zg(n),ge.b((({message:{id:e,messageNode:t,index:n},context:i})=>{this._state.modify((a=>({...a,expandedMessages:new Map(a.expandedMessages).set(e,(0,o.zG)(i,ra.g_((t=>{const n=`Could not extract context for #${e}: ${t}`;return this._logger.warn(n),p.kH(new ha.DH(n))}),(i=>(0,o.zG)(g.fromNullable(t.querySelector(Lo.xR)),g.filter(Qo.Re),g.fold((()=>{const n=`Could not find message body for #${e}`;return this._logger.warn(n,t),p.kH(new ha.DH(n))}),(a=>{this._logger.trace(`Message #${e} extracted`),this._logger.trace(`Got ${i.links.length} links`);const o=gs(a);return p.Vp({id:e,index:n,messageNode:t,bodyNode:a,context:i,textMap:o,semanticInformation:{...i.semanticInformation,tableTextCoverage:ps(o,a)}})})))))))})))}))).subscribe())}dispose(){this._subscriptions.unsubscribe()}}function ps(e,t){const n=[];t.querySelectorAll("table").forEach((e=>{0!==n.length&&n[n.length-1].contains(e)||n.push(e)}));const i=e.getPlainText().replace(/\s+/g,""),a=n.map((e=>e.innerText.replace(/\s+/g,"")));let o=i;for(const e of a)o=o.replace(e,"");return Math.max(0,Math.min(1,(i.length-o.length)/i.length))}function hs(e){return(0,o.zG)(g.fromNullable(e.getAttribute("src")),g.filter((e=>!e.includes("no_photo")&&!e.includes("profile_mask"))))}function gs(e){return new Ho.Z(e,((e,t)=>Ho.Z.defaultFilterNodeAllowList(["PRE","CODE","BLOCKQUOTE"])(e,t)&&!qo.W.maybeGmailHistoryQuote(e)),void 0,Ho.Z.isBlockNodeFromTagList((0,o.zG)(new Set(Ho.Z.blockTags),Do.Od(Pa.yv)("CODE"))),void 0,void 0,qo.W.gmailNodeFormatting,void 0,void 0,!1)}function fs(e){return a.Y(ra.wE)({email:(0,o.zG)(ra.ij(new ha.DH("No email found"))(null==e?void 0:e.getAttribute("email")),ra.tS((e=>ra.Yo((()=>new ha.DH("Invalid email address")))(na.G.create(e))))),name:(0,o.zG)(ra.ij(new ha.DH("No name found"))(null==e?void 0:e.getAttribute("name")),ra.UI((e=>e||void 0)))})}function bs(e,t,n=6e3){return i=>Sa.T(...e.map((e=>{return i.pipe(ze.h((t=>t.message.id===e.id)),(a=n,e=>{const t=e.pipe(ts.B()),[n,i]=ns.u(t,((e,t)=>0===t));return Sa.T(n.pipe(Ao.V(a),Na.q(1)),i)}),Po.K((n=>U.of({message:e,context:ra.t$(new ha.DH(t+((null==n?void 0:n.message)?` [${n.message}]`:"")))}))));var a})))}function vs(e,t,n,i,s,r=5){return l=>{const{left:d,right:c}=(0,o.zG)(l,no.uK(i));return Sa.T((0,o.zG)(d,Is(e),bs(d,"DOM-only extraction timeout")),Sa.T((0,o.zG)(c,Is(e),bs(c,"DOM extraction timeout"),x.U((e=>({...e,kind:"fromDOM"})))),(0,o.zG)(c,function(e,t,n,i=5){const a=new pe.xQ,s=new Map;return r=>Sa.T(U.of(r),a).pipe(Ye.w((e=>oa.D(e.reduce(((e,t)=>(e.length>0&&e[e.length-1].length<i?e[e.length-1].push(t):e.push([t]),e)),[])))),he.M(e),Ta.b((([e,n])=>function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,Vo.k)(n))return Bo(n,null);if((0,Oo.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);return Bo(i.map((function(e){return n[e]})),i)}}if("function"==typeof e[e.length-1]){var a=e.pop();return Bo(e=1===e.length&&(0,Vo.k)(e[0])?e[0]:e,null).pipe((0,x.U)((function(e){return a.apply(void 0,e)})))}return Bo(e,null)}(e.map((e=>oa.D(cs(e.id,n,t())).pipe(x.U((t=>({message:e,headers:t}))))))))),Ta.b((e=>e)),Ye.w((({message:e,headers:t})=>(0,o.zG)(t,ra.g_((t=>{n.warn(`Error accessing MIME headers for #${e.id}:`,t.message);const i=s.get(e.id)||0,o=1;return t.mimeMessageNotFound&&i<o?(n.warn(`Retrying to fetch MIME headers for #${e.id}`),s.set(e.id,i+1),a.next([e]),Yo.E):U.of({message:e,context:ra.t$(new ha.DH(t.message))})}),(t=>U.of({message:e,context:ra.F2({date:{kind:"parsedDate",timestamp:t.date.getTime()},author:t.from,audience:t.to.concat(t.cc||[]).concat(t.bcc||[]),replyTo:t.replyTo||[],links:[],isFromMailingList:!!t.listUnsubscribe,semanticInformation:{isWholeHTMLDocument:/^text\/html\b/.test(t.headers["content-type"])}})})))))))}(t,n,s,r),bs(c,"MIME headers extraction timeout"),x.U((e=>({...e,kind:"fromHeaders"}))))).pipe(is.v((e=>e.message.id)),za.zg((e=>e.pipe(ge.b((e=>(0,o.zG)(e.context,ra.Vn((t=>s.warn(`Context extraction error [${e.kind}] for ${e.message.id}`,t)))))),Aa.R(((e,t)=>({...e,message:t.message,[t.kind]:t.context})),{}),ze.h((e=>!!(null==e?void 0:e.message)&&!!(null==e?void 0:e.fromDOM)&&!!(null==e?void 0:e.fromHeaders))),x.U((e=>(0,o.zG)(a.Y(ra.wE)({fromDOM:e.fromDOM,fromHeaders:e.fromHeaders}),ra.UI((({fromDOM:e,fromHeaders:t})=>(0,$o.RH)(e,t))),ra.wp((()=>e.fromDOM)),ra.wp((()=>e.fromHeaders)),(t=>({message:e.message,context:t})))))))))).pipe(ge.b((e=>(0,o.zG)(e.context,ra.g_((t=>s.warn(`Context extraction error for ${e.message.id}`,t)),(t=>s.info(`Context extracted for ${e.message.id}`,t)))))))}}function Is(e){return t=>U.of(t).pipe(as.u(),za.zg((t=>{var n;const i=(0,o.zG)(ra.ij(new ha.DH("No message date found"))(null===(n=t.messageNode.querySelector(Lo.ms))||void 0===n?void 0:n.getAttribute("title")),ra.UI((t=>(0,o.zG)(new Date(t),(n=>{var i;return Number.isNaN(n.valueOf())?{kind:"unparsedDate",date:t,locale:(null===(i=e.querySelector(Lo.Gg))||void 0===i?void 0:i.getAttribute(Lo.sC))||void 0}:{kind:"parsedDate",timestamp:n.getTime()}}))))),a=(0,o.zG)(ra.ij(new ha.DH("No message author found"))(t.messageNode.querySelector(Lo.OL)),ra.tS(fs)),s=(0,o.zG)(ra.ij(new ha.DH("No <to> field found in message"))(t.messageNode.querySelectorAll(Lo.VN)),ra.tS((e=>(0,o.zG)(Array.from(e),no.UI(fs),no.IX.sequence(ra.wE))))),r=(0,o.zG)(t.messageNode.querySelector(Lo.hZ),(e=>ra.F2(!!e)));return B.aj([U.of({message:t,date:i,author:a,audience:s,isFromMailingList:r}),(l=t.messageNode,B.aj([U.of(_s(l)),(0,o.zG)(Array.from(l.querySelectorAll(Lo.Mz)).map(Us),(e=>e.length>0?B.aj(e):U.of([])))]).pipe(x.U((([e,t])=>Array.from(e.concat(t).reduce(((e,t)=>e.set(t.url,t)),new Map).values())))))]);var l})),x.U((([{message:e,date:t,author:n,audience:i,isFromMailingList:o},s])=>({message:e,context:a.Y(ra.wE)({date:t,author:n,audience:i,replyTo:ra.F2([]),links:ra.F2(s),isFromMailingList:o})}))))}function ks(e){return Array.from(e.children).filter(ys)}function ys(e){return e instanceof HTMLDivElement&&(e.matches("[aria-expanded]")&&!!e.innerText||!e.matches("[aria-expanded]"))}function xs(e){return e instanceof HTMLDivElement&&e.matches('[tabindex="-1"]')&&!!e.innerText}function _s(e){return Array.from(e.querySelectorAll(Lo.rf)).filter((e=>!e.closest(Lo.A4)&&!e.matches(Lo.wJ))).map((e=>{const t=e.getAttribute("href");return{name:e.innerText,url:ca.Au.create(t),type:t.startsWith("mailto:")?ea.QC.email:ea.QC.hyperlink}}))}function Es(e){return(0,o.zG)(g.fromNullable(e),g.chain((e=>g.fromNullable(/^([^\:]+)\:([^\:]+)\:(https?\:\/\/.+)?(https?\:\/\/.+)$/.exec(e)))),g.map((([e,t,n,i,a])=>({name:decodeURIComponent(n),url:ca.Au.create(a),type:ea.QC.attachment,mimeType:ca.Iz.create(t)}))))}function ws(e){var t;return{name:e.getAttribute("data-tooltip")||(null===(t=e.querySelector("div"))||void 0===t?void 0:t.innerText)||e.innerText,url:ca.Au.create(e.getAttribute("href")||""),type:ea.QC.attachment,mimeType:void 0}}function Us(e,t=4e3){return(0,o.zG)(e.getAttribute("href")||"",g.fromPredicate((e=>!/^https?\:\/\/docs\.google\.[^.\/]+\//.test(e))),g.map((n=>new Ro.y((t=>{var n;(0,o.zG)(g.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),g.filter((e=>!!e)),g.fold((()=>t.error("Attachment not found")),(()=>{t.next(!0),t.complete()})))})).pipe((0,Zo.WV)(t/200,200),Ao.V(t),Po.K((()=>U.of(!1))),x.U((t=>{var n;return(0,o.zG)(g.fromNullable(null===(n=e.parentElement)||void 0===n?void 0:n.getAttribute("download_url")),g.chain(Es),g.getOrElse((()=>ws(e))))}))))),g.getOrElse((()=>U.of(ws(e)))))}function Cs(e){return Array.from(e.querySelectorAll(Lo.Py)).filter(xs).length}var Ns;function Ss(e){const t=e.querySelector(Lo.bK),n=t?ks(t).length:0;if(!t||0===n)return U.of(ra.t$("No messages"));if(Cs(e)===n)return U.of(ra.F2(Ns.noExpansionNeeded));const i=e.querySelector(Lo.p4);return null==i||i.click(),(0,o.zG)((a=t,zo.rl(a,{subtree:!0,childList:!1,attributes:!0,attributeFilter:["role","aria-expanded"]}).pipe(W.O(null))),Fa.b(10),ze.h((()=>Cs(e)===n)),Ao.V(3e3),Na.q(1),Ma.h(ra.F2(Ns.expanded)),Po.K((e=>U.of(ra.t$(e.message)))));var a}!function(e){e.expanded="expanded",e.noExpansionNeeded="noExpansionNeeded"}(Ns||(Ns={}));var Ms=n(41263),Gs=n(86620),Fs=n(92132),Ts=n(33678),zs=n(15073),As=n(42103),Ps=n(64078);const Ls=({env:e,children:t,className:n})=>u.createElement(Go.o,{className:n},u.createElement(No.p,null,u.createElement(Ts.a.Context.Provider,{value:new Gs.C(e)},u.createElement(Fs.Q,{remSize:U.of(16),setter:e=>zs.u.setRootCssVar(document.documentElement,e)},u.createElement(As.G.DefaultProvider,null,t,u.createElement(Mo.p,{regular:!0,bold:!0}),u.createElement(So.G,null),u.createElement(Ps.X,null))))));var Ds=n(16782);const Rs=`${Lo.k2} > div + div`;class Vs{constructor(e,t,n=Ua.Y.create("Reader-Gmail-Panel")){this._logger=n,this._mounted=new Ds.t(1),this.elementRef=u.createRef(),this.mounted=this._mounted.asObservable(),this._injectionSub=e.pipe(Ye.w((e=>new Ro.y((()=>(0,o.zG)(g.fromNullable(e.querySelector(Rs)),g.filter((e=>e instanceof HTMLElement)),g.fold((()=>o.Q1),(e=>{const n=mo.VB.get({monitorAs:"reader-panel"}).inject(uo.EM.fromDocument(e.ownerDocument,"grammarly-extension"),uo.zs.appendChild(e),(()=>u.createElement(Ms.L,{chunkName:"readerGmailThreadIntegration"},u.createElement(Ls,{env:(0,d.O)()},u.createElement("div",{style:{marginTop:"2rem"},ref:this.elementRef},u.createElement(t,null))))));return this._mounted.next(),this._logger.debug("Panel injected"),()=>{n.dispose(),this._logger.debug("Panel disposed")}})))))))).subscribe()}dispose(){this._injectionSub.unsubscribe()}}var Os=n(35214),Bs=n(32426),Zs=n(45701),Hs=Os.getFunctionMonoid(g.getApplyMonoid({concat:(0,Bs.getJoinSemigroup)(Zs.ordNumber).concat,empty:0}))();function qs(e){return function(t){return t.iterNumber>=e?g.none:g.some(0)}}function js(e){return function(t){return g.some(e*Math.pow(2,t.iterNumber))}}var Ks={iterNumber:0,cumulativeDelay:0,previousDelay:g.none};var Qs=Hs;class $s{constructor(e){this._rpc=e,this.getReaderAnnotations=this._rpc.getReaderAnnotations,this.getReaderSummaries=this._rpc.getReaderSummaries}}var Ws=n(99596),Js=n(99950),Ys=n(62965);function Xs(e,t,n){var i=Os.fold(Qs)(t);return Ro.y.create((function(t){var a=!1,o=function(s){return(0,eo.pipe)(Ys.dk((function(){return t.next(p.x5)})),Ys.a1(e),Ys.g_((function(e){var r=!a&&n(e)?function(e,t){var n=e(t);return{iterNumber:t.iterNumber+1,cumulativeDelay:t.cumulativeDelay+g.getOrElse((function(){return 0}))(n),previousDelay:n}}(i,s):Ks;return(0,eo.pipe)(r.previousDelay,g.fold((function(){return Ys.t$(e)}),(function(n){return t.next(p.vU(e,{cumulativeDelay:r.cumulativeDelay,iterNumber:r.iterNumber,previousDelay:n})),(0,eo.pipe)(Ys.F2(r),Js.delay(n),Ys.tS((function(t){return a?Ys.t$(e):o(t)})))})))}),Ys.F2))};return(0,eo.pipe)(o(Ks),Ys.Pd((function(e){return t.next(p.kH(e))}),(function(e){return t.next(p.Vp(e))})))().then((function(){return t.complete()}),(function(e){return t.error(e)})),function(){return a=!0}}))}var er=n(77150);class tr{constructor(e,t,n=d.O,i,a=Ua.Y.create("Reader-Gmail-Remote-Data")){this._threadContext=e,this._useCaching=t,this._getEnv=n,this._telemetry=i,this._logger=a,this._subscriptions=new aa.w,this._rpcClient=(0,wa.Vo)((()=>new $s(this._getEnv().bgRpc.api))),this._summariesToFetch=new pe.xQ,this._annotationsToFetch=new pe.xQ,this._summariesReadyToFetch=new pe.xQ,this._annotationsReadyToFetch=new pe.xQ,this._summaries=q.h.create(new Map),this._annotations=q.h.create(new Map),this.summaries=this._summaries.view(),this.annotations=this._annotations.view(),this._subscriptions.add(this._summariesToFetch.pipe(nr(this._threadContext)).subscribe((e=>this._summariesReadyToFetch.next(e)))),this._subscriptions.add(this._annotationsToFetch.pipe(nr(this._threadContext)).subscribe((e=>this._annotationsReadyToFetch.next(e)))),this._subscriptions.add(this._summariesReadyToFetch.pipe(za.zg((e=>this._getSummaries(e).pipe(x.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._summaries.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(p.n2(t)?(0,o.zG)(g.fromNullable(n.get(i)),g.getOrElse((()=>p.x5))):t,p.UI((e=>g.fromNullable(e[i])))))),new Map(n))))}))),this._subscriptions.add(this._annotationsReadyToFetch.pipe(za.zg((e=>this._getAnnotations(e).pipe(x.U((t=>({requestedIds:e,response:t}))))))).subscribe((({requestedIds:e,response:t})=>{this._annotations.modify((n=>Array.from(e).reduce(((e,i)=>e.set(i,(0,o.zG)(p.n2(t)?(0,o.zG)(g.fromNullable(n.get(i)),g.getOrElse((()=>p.x5))):t,p.UI((e=>g.fromNullable(e[i])))))),new Map(n))))})))}fetchSummaries(e){this._logger.debug(`requesting summaries for [${Array.from(e)}]`),this._summariesToFetch.next(e)}fetchAnnotations(e){this._logger.debug(`requesting annotations for [${Array.from(e)}]`),this._annotationsToFetch.next(e)}dispose(){this._subscriptions.unsubscribe()}_getThreadInfoForBackend(){return(0,o.zG)(this._threadContext.get(),(e=>a.Y(ra.wE)({id:e.threadId,subject:e.subject,messageCount:ra.F2(e.messageCount),messages:ra.F2(Array.from(e.expandedMessages.values()).filter(p.d6).map((e=>e.value))),loggedUser:e.loggedUser})),ra.UI((e=>({...e,messages:e.messages.reduce(((t,n)=>(t[n.id]={id:n.id,index:n.index,subject:e.subject,body:n.textMap.getRichText(),plainText:n.textMap.getPlainText(),date:n.context.date,author:n.context.author,audience:n.context.audience,replyTo:n.context.replyTo,semanticInformation:n.semanticInformation,links:n.context.links,isFromMailingList:n.context.isFromMailingList},t)),{})}))))}_getSummaries(e){return(0,o.zG)(this._getThreadInfoForBackend(),ra.g_((e=>U.of(p.kH(e))),(t=>Xs((()=>(this._logger.debug(`Fetching summaries for [${Array.from(e)}]`),this._rpcClient.get().getReaderSummaries({id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,ea.fH)(t),e)))),num_messages:t.messageCount},(0,ea.Rs)(t.loggedUser),Array.from(e),this._useCaching.get()).then((e=>((0,o.zG)(e,ra.Pd((e=>{this._telemetry.readerGmail.warning("summariesResponse",e.message,e),this._logger.warn("Summaries error",e.message)}),(e=>{this._logger.debug("Received summaries",e)}))),e))))),[qs(3),js(5e3)],(e=>e instanceof Ws.Lu||e instanceof Ws.Bb&&e.code>=500)))))}_getAnnotations(e){return(0,o.zG)(this._getThreadInfoForBackend(),ra.g_((e=>U.of(p.kH(e))),(t=>Xs((()=>(this._logger.debug(`Fetching annotations for [${Array.from(e)}]`),this._rpcClient.get().getReaderAnnotations({id:t.id,subject:t.subject,messages:(0,o.zG)(t.messages,l.u4({},((e,t)=>(e[t.index]=(0,ea.fH)(t),e)))),num_messages:t.messageCount},(0,ea.Rs)(t.loggedUser),Array.from(e),this._useCaching.get()).then((e=>((0,o.zG)(e,ra.Pd((e=>{this._telemetry.readerGmail.warning("annotationsResponse",e.message,e),this._logger.warn("Annotations error",e.message)}),(e=>{this._logger.debug("Received annotations",e)}))),e))).then(ra.UI((0,o.ls)(l.Su(((e,n)=>{var i;const a=null===(i=t.messages[e])||void 0===i?void 0:i.plainText;return{...n,annotations:void 0!==a?n.annotations.map((e=>({...e,text:a.slice(e.span.s,e.span.e)}))):[]}}))))))),[qs(3),js(5e3)],(e=>e instanceof Ws.Lu||e instanceof Ws.Bb&&e.code>=500)))))}}function nr(e){return t=>{const n=new pe.xQ;return(0,o.zG)(t,Ta.b((e=>oa.D(Array.from(e)))),za.zg((t=>e.pipe(x.U((e=>(0,o.zG)(g.fromNullable(e.expandedMessages.get(t)),g.fold(o.jv,p.d6)))),ze.h(wa.fQ),Na.q(1),Ma.h(t)))),ge.b((()=>n.next())),er.R((()=>n.pipe(Fa.b(200)))),x.U((e=>new Set(e))),ze.h((e=>e.size>0)))}}function ir(e,t,n,i,u,p,h,f,b,v=d.O,k=Ua.Y.create("Reader-Gmail-Thread-Integration")){const _=wa.iy.create(),C=new us(u.doc,e,vs(u.doc,t,(()=>u.url),(e=>0===e.index),k),b),N=new tr(C.threadContext,i,v,b),S=n.has("inlineCards")?new To(B.aj([N.annotations,p.view((e=>(0,o.zG)(C.threadContext.get().threadId,g.fromEither,g.chain((t=>{var n,i;return(0,o.zG)(g.fromNullable(null===(i=null===(n=e.threadState)||void 0===n?void 0:n[t])||void 0===i?void 0:i.annotations),g.map((0,o.ls)(l.UI((0,o.ls)(m.T.decode,g.fromEither)),l.oA,l.u4(new Set,((e,t)=>t.dismissed?e.add(t.itemId):e)))))})),g.getOrElse((()=>new Set)))))]).pipe(he.M(C.threadContext),x.U((([[e,t],n])=>(0,o.zG)(e,r.Su(((e,i)=>(0,o.zG)(a.Y(g.option)({annotations:(0,o.zG)(i,Zo.zk,g.flatten,g.map(re.ei("annotations")),g.map(s.hX((e=>!t.has(m.p.Id.create(e.id))))),g.chain(qe.nI)),message:(0,o.zG)(g.fromNullable(n.expandedMessages.get(e)),g.chain(Zo.zk))}),g.map((({annotations:e,message:t})=>({messageId:t.id,textMap:t.textMap,bodyNode:t.bodyNode,annotations:e})))))),r.DZ(o.yR))))),e):null,M=new pe.xQ,G=function(e,t,n){const i=e=>(0,o.zG)(t.get().threadId,g.fromEither,lt.bw(e));return{onboardingFinished:t=>e.seenReaderGmailOnboarding(t),navigate:(e,t)=>n.next({nextActiveIndex:e,navigationAction:t}),updateSummaryItem:t=>i((n=>e.readerGmailUpdateSummaryItem({threadId:n,item:t}))),updateAnnotationItem:t=>i((n=>e.readerGmailUpdateAnnotationItem({threadId:n,item:t}))),updatePersonItem:t=>i((n=>e.readerGmailUpdatePersonItem({threadId:n,item:t}))),updateLinkItem:t=>i((n=>e.readerGmailUpdateLinkItem({threadId:n,item:t})))}}(h,C.threadContext,M),F=(T=n).has("summaries")||T.has("needsResponse")||T.has("peopleAndLinks")||T.has("mentions")||T.has("links")?new fa(C.threadContext,N.summaries,N.annotations,u.config.bundleInfo.browser,f,_,n,p.get(),G):null;var T;const z=F?new Vs(C.threadContext.view((e=>e.messageCount)).pipe(x.U((()=>{const t=ks(e);return g.fromNullable(t[t.length-1])})),w.oA,Je.x()),(()=>{return E.UI.mount(Wi,(e=F,E.Z.composeKnot({content:E.Z.composeUnion({collapsed:Te(e),expanded:Ni(e),onboarding:Qi(e)},(()=>e.state.pipe(x.U((e=>({kind:y(e)&&I(e.activeView)?"onboarding":e.kind})))))),notification:D(e)})));var e})):null,A=M.pipe(Ye.w((()=>Ss(u.doc))),ge.b(ra.Pd((e=>k.warn("Error while expanding messages",e)),(e=>{switch(e){case Ns.expanded:return k.trace("Messages expanded");case Ns.noExpansionNeeded:return k.trace("Thread already expanded");default:(0,Z.vE)(e)}}))),Ca.shareReplay({bufferSize:1,refCount:!0})),P=C.threadContext.pipe(Na.q(1),ge.b((e=>f.readerMailSessionStart(e.messageCount,_,(0,o.zG)(e.threadId,g.fromEither,g.toUndefined))))).subscribe(),L=(0,c.W$)(e),R=L?Sa.T(M.pipe(x.U((e=>{var t;return(null===(t=null==z?void 0:z.elementRef)||void 0===t?void 0:t.current)?z.elementRef.current.getBoundingClientRect().top:null}))),A.pipe(Ma.h(null))).pipe(Ga.G()).subscribe((([e,t])=>{var n;if((null===(n=null==z?void 0:z.elementRef)||void 0===n?void 0:n.current)&&null===t&&null!==e){const t=z.elementRef.current.getBoundingClientRect().top;L.scrollTop=L.scrollTop+t-e}})):null,V=A.subscribe(),O=p.pipe(Ye.w((e=>e.seenOnboarding?U.of(!!e.enabled):p.pipe(ze.h((e=>!!e.seenOnboarding)),x.U((e=>!!e.enabled))))),Na.q(1)),H=n.has("summaries")&&z?Sa.T(M,z.mounted.pipe(x.U((e=>({nextActiveIndex:1/0,navigationAction:"last"}))),(0,Zo.Gx)(O))).pipe(Fa.b(100),Ta.b((({nextActiveIndex:e,navigationAction:t})=>{const n=C.threadContext.get().messageCount,i=e=>e>=0&&e<n;switch(t){case"left":return oa.D([e-1,e].filter(i));case"right":return oa.D([e,e+1].filter(i));case"first":return oa.D([0,1].filter(i));case"last":return oa.D([n-2,n-1].filter(i));default:(0,Z.vE)(t)}})),za.zg((e=>C.threadContext.view((t=>t.messageIndexToIdMap.get(e))).pipe(ze.h(wa.fQ),Na.q(1)))),Aa.R(((e,t)=>new Set(e).add(t)),new Set),(0,Zo.Yp)(Pa.yv)).subscribe((e=>N.fetchSummaries(e))):null,q=n.has("needsResponse")||n.has("inlineCards")?C.threadContext.view((e=>new Set(e.messageIndexToIdMap.values()))).pipe(Aa.R(((e,t)=>new Set(Array.from(e).concat(Array.from(t)))),new Set),(0,Zo.Yp)(Pa.yv),(0,Zo.Gx)(O)).subscribe((e=>N.fetchAnnotations(e))):null;return"prod"!==u.config.bundleInfo.env&&(0,Zo.h$)(u.doc,{threadContextManager:C,threadRemoteDataManager:N,panelViewModel:F}),k.debug("page integration created"),()=>{f.readerMailSessionEnd(_,(0,o.zG)(C.threadContext.get().threadId,g.fromEither,g.toUndefined)),null==q||q.unsubscribe(),null==H||H.unsubscribe(),P.unsubscribe(),V.unsubscribe(),null==R||R.unsubscribe(),null==z||z.dispose(),null==F||F.dispose(),null==S||S.dispose(),N.dispose(),C.dispose(),k.debug("page integration disposed")}}},86620:(e,t,n)=>{n.d(t,{C:()=>d,U:()=>i});var i,a=n(27378),o=n(29511),s=n(33678),r=n(88056),l=n(95574);!function(e){let t;!function(e){e.isAppleSystem="isAppleSystem"}(t=e.SidebarFlag||(e.SidebarFlag={})),e.Flag={...t,...s.a.Flag},e.Context=a.createContext(r.Y.invariantContent("Environment"))}(i||(i={}));class d{constructor(e=(0,o.O)()){this._flags=new Set,this.actions={openUrl:e=>l.vM((()=>{document.location.href=e.toString()})),openPopup:e=>l.vM((()=>{const t=self.open(e.toString(),void 0,"noreferrer");t&&(t.opener=null)}))},e.config.systemInfo.os.isMac&&this._flags.add(i.Flag.isAppleSystem),this._flags.add(i.Flag.supportsSVGDominantBaseline),this._flags.add(i.Flag.onlyTrustedEvents)}has(e){return this._flags.has(e)}}},92132:(e,t,n)=>{n.d(t,{Q:()=>l});var i=n(27378),a=n(15073),o=n(60797),s=n(95300),r=n(5114);const l=({children:e,remSize:t,setter:n})=>(d+=1,i.useEffect((()=>{const e=t.subscribe((e=>{c.next(r.some(e)),n(r.some(e))}));return()=>{e.unsubscribe(),d-=1,0===d&&(c.next(r.none),n(r.none))}}),[t]),i.createElement(a.u.Context.Provider,{value:c.pipe(o.oA)},e));let d=0;const c=new s.X(r.none)},86705:(e,t,n)=>{n.d(t,{v:()=>o});var i=n(27378),a=n(80895);const o=({browser:e,className:t,title:n="BETA"})=>"safari"!==e?i.createElement(a.C,{title:n,className:t}):null},31944:(e,t,n)=>{n.d(t,{J:()=>r});var i=n(57050),a=n(27378),o=n(12187),s=n(22536);const r=({onChange:e,labelId:t,className:n,checkboxClassName:r,labelClassName:l,checked:d,children:c,disabled:m,dataGrammarlyPart:u="ui-kit-checkbox",tabIndex:p=0})=>{const[h,g]=a.useState(null!=d&&d);a.useEffect((()=>{g(Boolean(d))}),[d]);const f=t=>{t.preventDefault(),t.stopPropagation(),g(!h),null==e||e(!h)};return a.createElement("div",{"data-grammarly-part":u,...(0,o.Sh)(s.checkboxContainer,n)},a.createElement("div",{...(0,o.Sh)(s.checkbox,r,h?s.checkboxChecked:null),role:"checkbox","aria-checked":h,tabIndex:p,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&f(e)},onClick:m?i.Q1:f},h?a.createElement("div",{className:s.checkboxCheckmark}):null),a.createElement("label",{id:t,onClick:f,className:l},c))}},57053:(e,t,n)=>{n.d(t,{i:()=>s});var i=n(27378),a=n(12187),o=n(39070);const s=({maxRating:e=5,ratingLabels:t=["Not at all valuable","Slightly valuable","Somewhat valuable","Very valuable","Extremely valuable"],onChange:n,value:s,ariaLabel:r="Rating",className:l,ratingStarsClassName:d,ratingLegendClassName:c,ratingLabelsClassName:m})=>{const[u,p]=i.useState(s),[h,g]=i.useState(void 0);i.useEffect((()=>{p(s)}),[s]),i.useEffect((()=>{void 0!==u&&n(u)}),[u]);const f=[...Array(e).keys()].map((e=>e+1)),b=void 0!==h?h:u;return i.createElement("div",{"data-grammarly-part":"ui-kit-rating",role:"radiogroup","aria-label":r,...(0,a.Sh)(o.rating,l)},i.createElement("div",{...(0,a.Sh)(o.ratingStars,d),onMouseLeave:()=>g(void 0)},f.map((e=>{const t=void 0!==b&&b>=e;return i.createElement("input",{key:`rating-${e}`,id:`rating-${e}`,type:"radio",name:"rating",checked:u===e,onChange:e=>p(parseInt(e.target.value,10)),value:e,onMouseEnter:e=>{const t=e.target;g(parseInt(t.value,10))},...(0,a.Sh)(o.ratingStar,t?o.ratingStarFilled:null)})}))),i.createElement("div",{...(0,a.Sh)(o.ratingLabels,m)},f.map((e=>i.createElement("label",{key:`rating-label-${e}`,htmlFor:`rating-${e}`,...(0,a.Sh)(b===e?o.ratingLabelVisible:o.ratingLabelNotVisible)},t[e-1])))),void 0!==b?null:i.createElement("div",{...(0,a.Sh)(o.ratingLegend,c)},i.createElement("div",null,t[0]),i.createElement("div",null,t[f.length-1])))}},18347:(e,t,n)=>{n.d(t,{Eh:()=>a,Od:()=>s,e5:()=>o,nI:()=>r});var i=n(13853),a=(i.ZN,new Set,i.AO,i.Eh);i.G,i.UI,i.yW,i.tS,i.KX;i.t9,i.G0,i.jV,i.tV;var o=i.e5,s=(i.Lf,i.oP,i.u4,i.Lx,i.ri,i.$T,i.Od);var r=i.nI;i.oA,i.xu,i.DZ},31846:e=>{e.exports={avatar:"xNYnb",image:"_3Yg3q"}},83771:e=>{e.exports={layout:"_1hKpE",column:"_1rBJw",scrollView:"_1wR-W",sectionTitle:"-RBKX"}},47397:e=>{e.exports={empty:"_1XVf-",title:"_2AfjV",body:"_21gih"}},93253:e=>{e.exports={item:"_27MUw",content:"e2xP-",moreButton:"_2is65",pinned:"_1L-Hp",ellipsis:"_2TIW4"}},67465:e=>{e.exports={menu:"_1f4lm",pinned:"_1uRyx",button:"_12QVt",separator:"Q9ySg",inactiveIcon:"_2taPz"}},50243:e=>{e.exports={list:"u22ST"}},38459:e=>{e.exports={linkAndIcon:"_2mO4u",link:"_3djIE",linkWrapper:"kGyxh",icon:"_26TDA"}},45587:e=>{e.exports={itemLoading:"KdASy",lineOnly:"_3gA50",line:"_3btGG",lineLoading:"_3W_2s",rect:"_2Ln0z",rectLoading:"_1pxCc",lineAndCheckbox:"_3ZgMs",lineAndAvatar:"_1j1Dr"}},93383:e=>{e.exports={personAndAvatar:"_29ogH",nameOrEmail:"_3QT6s"}},69566:e=>{e.exports={title:"rOb7m"}},11071:e=>{e.exports={textChecked:"_1Sg3F",checkboxWrapper:"_45wj5",label:"_1ybvy",checkbox:"T4rHe",itemText:"pqhgN"}},83581:e=>{e.exports={itemText:"_3h7i6"}},48789:e=>{e.exports={loader:"_38SVK"}},79579:e=>{e.exports={emptyCTAButton:"_3kUpB"}},78870:e=>{e.exports={dialog:"_2-QQ0",header:"_1EWW5",headerGroup:"_1JdLn",buttons:"_3p63M",textbox:"_1CLrn",requiredTextBox:"_2T8Ox",requiredLabel:"_3HHRw"}},61033:e=>{e.exports={panelOverlay:"_1qTMO",dialog:"yOM_O"}},56229:e=>{e.exports={title:"_2k48T",ratingContainer:"_3T2eO",ratingStars:"_1WWyq",ratingLegend:"_9LsLz",ratingLabels:"_1j0UE"}},35115:e=>{e.exports={title:"_57M23",description:"_2sj__"}},89739:e=>{e.exports={activeMailInfo:"_31J8M",date:"fHbk9",author:"BD2pG"}},37903:e=>{e.exports={header:"_1mfP5"}},14692:e=>{e.exports={navigationFrame:"v_SsT",buttonGroup:"_3n1p4",iconJump:"_22-y3",iconGoFirst:"_2OzZD",icon:"_3hVGV"}},16204:e=>{e.exports={buttonGroup:"_2tWWr",button:"_1jXO0"}},76168:e=>{e.exports={notification:"_1xXpR"}},40349:e=>{e.exports={controls:"_2Hipc",onboardingButtonGroup:"_-9OmU",optInButton:"_5OTjn",optOutButton:"_30tah",navigation:"_1jU2d",leftButton:"P6wpw",rightButton:"_3CBvI",arrowRight:"D-jgQ",stepOfN:"_1HJSf"}},57391:e=>{e.exports={illustration:"fcee3"}},51869:e=>{e.exports={onboarding:"_2ODbM",logo:"Lr1qJ",content:"_3-26v",badge:"_3POlX",steps:"_31CBV"}},19230:e=>{e.exports={title:"gf4R_",body:"_2Vehu"}},23556:e=>{e.exports={header:"_3kzGL"}},86885:e=>{e.exports={panelWrapper:"dVcQ2"}},35300:e=>{e.exports={onboarding:"_1hppt",toolbar:"_38d_I"}},64908:e=>{e.exports={panelGrid:"_1oojw",header:"_15T_5",toolbar:"_3jOrT"}},58120:e=>{e.exports={recapButton:"_318vF",logo:"Tn0sZ",recap:"_3L1sH"}},22536:e=>{e.exports={checkboxContainer:"_3bj_g",checkbox:"xrB8R",checkboxChecked:"Uhddy",checkboxCheckmark:"_1qI2g",spin:"_3S_a3"}},39070:e=>{e.exports={rating:"_2oJv0",ratingStars:"_3FAXT",ratingStar:"_1p53S",ratingStarFilled:"_1E3qz",ratingLabels:"jzPuo",ratingLabelVisible:"_3yF9v",ratingLabelNotVisible:"_2zNv4",ratingLegend:"_1XbY_",spin:"fu5_3"}}}]);